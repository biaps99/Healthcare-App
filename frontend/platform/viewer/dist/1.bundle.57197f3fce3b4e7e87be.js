(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1433:function(e,t,r){var n=r(421);e.exports=function(e,t){return n(t,(function(t){return e[t]}))}},1436:function(e,t,r){"use strict";var n=r(19),a=r(0),s=r.n(a),i=r(135),o=r(258),c=r(202),u=r(12),l=r(1437),d=r(1435),f=r(1),p=r.n(f),y=r(268),v=r(11),S=r(114),m=r(426),g=r(1441);function h(e,t,r,n,a,s,i){try{var o=e[s](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,a)}function I(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function i(e){h(s,n,a,i,o,"next",e)}function o(e){h(s,n,a,i,o,"throw",e)}i(void 0)}))}}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function D(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var w=i.a.OHIFStudyMetadata,R=i.a.OHIFSeriesMetadata,U=o.a.retrieveStudiesMetadata,O=o.a.deleteStudyMetadataPromise,x=c.a.studyMetadataManager,j=c.a.makeCancelable,C=function(e,t,r,n){var a=!1;return n||(a=A(e,t,r)),a},A=function(e,t,r){var n,a,s,i,o,c,u,l=!1;if(Object.keys(r).length>0){var d=r.seriesInstanceUID,f=(n=t.getDisplaySets(),a=d,s=function(e,t){return t.SeriesInstanceUID===e},i=D(n),o=[],c=0,(u=a.split(",")).forEach((function(e){var t=i.findIndex(s.bind(void 0,e));if(t>=0){var r=b(i.splice(t,1),1)[0];o[c]=r,c++}})),{promoted:c===u.length,data:[].concat(o,D(i))});e.displaySets=f.data,l=f.promoted}return l},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=t.seriesInstanceUID,a=!0;if(!n)return a;var s=n.split(","),i=function(){if(f.length===s.length)return f.every((function(e){return s.some((function(t){return t===e.SeriesInstanceUID}))}))},o=function(){for(var e=!0,t=0;t<s.length;t++){var r=s[t],n=f[t];if(!n||n.SeriesInstanceUID!==r){e=!1;break}}return e},c=e.series,u=void 0===c?[]:c,l=e.displaySets,d=void 0===l?[]:l,f=r?u:d,p=r?i:o;return a=!!f&&p()},k=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e){var n=r.show,a=void 0===n?function(){}:n;a({message:t})}},E=function(e,t){var r=y.c.modules.sopClassHandlerModule,n=e.getData(),a=new R(t,n);e.getSeriesByUID(t.SeriesInstanceUID)?e.updateSeries(t.SeriesInstanceUID,a):e.addSeries(a),e.createAndAddDisplaySetsForSeries(r,a),n.displaySets=e.getDisplaySets(),n.derivedDisplaySets=e.getDerivedDatasets({Modality:t.Modality}),q(n,e)},q=function(e,t){var r=e.StudyInstanceUID;x.get(r)||x.add(t)},L=function(e,t){var r=y.c.modules.sopClassHandlerModule;e.displaySets||(e.displaySets=t.createDisplaySets(r)),e.derivedDisplaySets&&t._addDerivedDisplaySets(e.derivedDisplaySets)},F=function(e){return{StudyInstanceUID:e.StudyInstanceUID,series:e.series.map((function(e){return{SeriesInstanceUID:e.SeriesInstanceUID}}))}};function P(e){var t,n,i=e.server,o=e.studyInstanceUIDs,c=e.seriesInstanceUIDs,f=e.clearViewportSpecificData,p=e.setStudyData,y=e.user,h=b(Object(a.useState)(!1),2),R=h[0],A=h[1],P=b(Object(a.useState)(!1),2),T=P[0],G=P[1],H=b(Object(a.useState)(!1),2),J=H[0],N=H[1],Q=b(Object(a.useState)([]),2),V=Q[0],_=Q[1],z=b(Object(a.useState)(!1),2),W=z[0],X=z[1],B=Object(v.I)(),K=Object(a.useContext)(S.c).appConfig,Y=void 0===K?{}:K,Z=Y.filterQueryParam,$=void 0!==Z&&Z,ee=Y.maxConcurrentMetadataRequests,te=function(e,r,n){if(Array.isArray(e)&&e.length>0){var a=e.map((function(e){p(e.StudyInstanceUID,F(e));var a=new w(e,e.StudyInstanceUID);return L(e,a),q(e,a),t[e.StudyInstanceUID]=j(ne(a,n)).then((function(t){t&&!t.isCanceled&&function(e,t,r){C(e,t,r,$)&&f(0);var n=M(e,r,$);k(n,"Query parameters were not totally applied. It might be using original series list for given study.",B),_([].concat(D(V),[e]))}(e,a,r)})).catch((function(e){e&&!e.isCanceled&&(G(e),u.a.error(e))})).finally((function(){X(!0)})),e}));_(a)}},re=function(){return _((function(e){return D(e)}))},ne=function(){var e=I(regeneratorRuntime.mark((function e(t,r){var n,a,s,i,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getData(),a=n.seriesLoader){e.next=3;break}return e.abrupt("return");case 3:return s=function(){var e=I(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.hasNext()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.next();case 4:if(n=e.sent,r){e.next=11;break}return"SEG"!==n.Modality&&"SR"!==n.Modality||E(t,n),re(),e.abrupt("return",s());case 11:return E(t,n),re(),e.abrupt("return",s());case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=ee||t.getSeriesCount(),o=Array(i).fill(null).map(s),e.next=8,Promise.all(o);case 8:return c=e.sent,X(!0),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),ae=function(){var e=I(regeneratorRuntime.mark((function e(){var t,a,s,l,d,f,p,v,S,m,h,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=localStorage.getItem("studyAccessControl"),a=JSON.parse(t),0===(s=a[o[0]])?(l=new URL("http://localhost/"),d=new URL("api/image_decrypt/?hasPerm=true&study=".concat(o[0],"&user=").concat(y.email),l),(f=new XMLHttpRequest).open("GET",d,!0),f.responseType="blob",f.setRequestHeader("Authorization","JWT ".concat(localStorage.getItem("access"))),f.send(),f.onload=function(){var e=r(798)(),t=[],s=f.response;e.loadAsync(s).then(function(){var e=I(regeneratorRuntime.mark((function e(r){var s,l,d,f,p,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(r.files);case 1:if((e.t1=e.t0()).done){e.next=10;break}return s=e.t1.value,e.next=5,r.file(s).async("blob");case 5:l=e.sent,d=new File([l],s,{type:"application/dcm"}),t.push(d),e.next=1;break;case 10:return e.next=12,Object(g.a)(t);case 12:f=e.sent,p={},y=c&&c[0],v=[i,o],y&&(p.seriesInstanceUID=y,$&&v.push(p)),(Y.splitQueryParameterCalls||Y.enableGoogleCloudAdapter)&&v.push(!0),n[o]=j(U.apply(void 0,v)).then((function(e){if(e&&!e.isCanceled){A(!0);var t=e[0].series.filter((function(e){return"SR"===e.Modality||"SEG"===e.Modality}));f[0].series=f[0].series.concat(t),f[0].seriesLoader=e[0].seriesLoader,f[0].seriesMap=e[0].seriesMap,f[0].wadoRoot=e[0].wadoRoot,f[0].wadoUriRoot=e[0].wadoUriRoot,f[0].qidoRoot=e[0].qidoRoots,f[0].FrameOfReferenceUID=e[0].FrameOfReferenceUID,f[0].ReferencedSeriesSequence=e[0].ReferencedSeriesSequence,te(f,p,!0)}})).catch((function(e){e&&!e.isCanceled&&(G(e),u.a.error(e))})),a[o]=1,localStorage.setItem("studyAccessControl",JSON.stringify(a));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}):1===s?(N(!1),p={},v=c&&c[0],S=[i,o],v&&(p.seriesInstanceUID=v,$&&S.push(p)),(Y.splitQueryParameterCalls||Y.enableGoogleCloudAdapter)&&S.push(!0),n[o]=j(U.apply(void 0,S)).then((function(e){e&&!e.isCanceled&&(A(!0),te(e,p,!0))})).catch((function(e){e&&!e.isCanceled&&(G(e),u.a.error(e))}))):(m=new URL("http://localhost/"),h=new URL("api/image_decrypt/?hasPerm=false&study=".concat(o[0],"&user=").concat(y.email),m),(b=new XMLHttpRequest).open("GET",h,!0),b.responseType="blob",b.setRequestHeader("Authorization","JWT ".concat(localStorage.getItem("access"))),b.send(),b.onload=function(){var e=r(798)(),t=[],s=b.response;e.loadAsync(s).then(function(){var e=I(regeneratorRuntime.mark((function e(r){var s,l,d,f,p,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=regeneratorRuntime.keys(r.files);case 1:if((e.t1=e.t0()).done){e.next=10;break}return s=e.t1.value,e.next=5,r.file(s).async("blob");case 5:l=e.sent,d=new File([l],s,{type:"application/dcm"}),t.push(d),e.next=1;break;case 10:return e.next=12,Object(g.a)(t);case 12:f=e.sent,p={},y=c&&c[0],v=[i,o],y&&(p.seriesInstanceUID=y,$&&v.push(p)),(Y.splitQueryParameterCalls||Y.enableGoogleCloudAdapter)&&v.push(!0),n[o]=j(U.apply(void 0,v)).then((function(e){if(e&&!e.isCanceled){A(!0);var t=e[0].series.filter((function(e){return"SR"===e.Modality||"SEG"===e.Modality}));f[0].series=f[0].series.concat(t),f[0].seriesLoader=e[0].seriesLoader,f[0].wadoRoot=e[0].wadoRoot,f[0].wadoUriRoot=e[0].wadoUriRoot,f[0].qidoRoot=e[0].qidoRoots,f[0].FrameOfReferenceUID=e[0].FrameOfReferenceUID,f[0].ReferencedSeriesSequence=e[0].ReferencedSeriesSequence,te(f,p,!1)}})).catch((function(e){e&&!e.isCanceled&&(G(e),u.a.error(e))})),a[o]=-1,localStorage.setItem("studyAccessControl",JSON.stringify(a));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})}catch(e){e&&(G(e),u.a.error(e))}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=Object(a.useCallback)((function(){for(var e in n)"cancel"in n[e]&&n[e].cancel();for(var r in t)"cancel"in t[r]&&(t[r].cancel(),O(r),x.remove(r))}),[t,n]),ie=Object(l.a)(o);if(Object(a.useEffect)((function(){!(ie&&ie.every((function(e){return o.includes(e)})))&&(x.purge(),se())}),[ie,se,o]),Object(a.useEffect)((function(){return t={},n={},ae(),function(){se()}}),[]),T){var oe=JSON.stringify(T);return oe.includes("404")||oe.includes("NOT_FOUND")?s.a.createElement(m.a,null):s.a.createElement(m.a,{message:"Failed to retrieve study data"})}return s.a.createElement(a.Fragment,null,R?s.a.createElement(d.a,{studies:V,isStudyLoaded:W,studyInstanceUIDs:V&&V.map((function(e){return e.StudyInstanceUID})),reload:J}):s.a.createElement(a.Fragment,null,s.a.createElement("h3",{style:{marginLeft:"20px"}},"Loading...")))}P.propTypes={studyInstanceUIDs:p.a.array.isRequired,seriesInstanceUIDs:p.a.array,server:p.a.object,clearViewportSpecificData:p.a.func.isRequired,setStudyData:p.a.func.isRequired,user:p.a.object};var T=Object(n.b)((function(e){return{user:e.auth.user}}),null)(P),G=r(22).a.redux.actions,H=G.clearViewportSpecificData,J=G.setStudyData,N=function(e){return!0===e.active},Q=Object(n.b)((function(e,t){var r=e.servers.servers.find(N);return{server:t.server||r}}),(function(e){return{setStudyData:function(t,r){e(J(t,r))},clearViewportSpecificData:function(){e(H())}}}))(T);t.a=Q},1437:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e}),[e]),t.current}},1438:function(e,t,r){var n=r(1433),a=r(219);e.exports=function(e){return null==e?[]:n(e,a(e))}}}]);
//# sourceMappingURL=1.bundle.57197f3fce3b4e7e87be.js.map