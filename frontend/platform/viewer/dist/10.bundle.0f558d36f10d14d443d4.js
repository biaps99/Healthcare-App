(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1389:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(135),o=n(202),l=n(1435),s=n(1),c=n.n(s),u=n(268),d=n(1465),m=n(1441),f=(n(1464),n(28)),p=n.n(f),g=n(11),y=n(1440),b=n(1443),h=(n(1439),n(3)),w=n.n(h),v=n(4),E=n.n(v);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=n(800),F=function(e){function t(e){var n,a,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,r=x(t).call(this,e),n=!r||"object"!==I(r)&&"function"!=typeof r?k(a):r,P(k(n),"logMouseButton",(function(e){if("object"===I(e)){var t=w.a.getViewport(n.state.element),a=w.a.getImage(n.state.element),r="".concat(a.width," x ").concat(a.height),i=t.voi.windowWidth,o=t.voi.windowCenter,l="W: ".concat(i.toFixed?i.toFixed(0):i," L: ").concat(i.toFixed?o.toFixed(0):o),s=E.a.getToolState(n.state.element,"stack").data[0];n.setState({scale:t.scale,wwwc:l,size:r,slice:s.currentImageIdIndex+1,stackSize:s.imageIds.length})}})),P(k(n),"logScrollButton",(function(){var e=E.a.getToolState(n.state.element,"stack").data[0];n.setState({slice:e.currentImageIdIndex+1,stackSize:e.imageIds.length})})),n.state={scale:null,stackSize:null,element:null,imageDimensions:null,slice:null},n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,e),n=t,(a=[{key:"componentDidMount",value:function(){if(this.props.nrrdFile){var e=this.props.nrrdFile,t=new FileReader;t.readAsArrayBuffer(e);var n=document.getElementsByClassName("ViewerMain")[0];n.innerText="",w.a.enable(n),this.setState({element:n}),n.addEventListener("mouseup",this.logMouseButton),n.addEventListener("wheel",this.logScrollButton);var a=this;t.onload=function(){var e=D.importNRRDImage(t.result),r=D.buildNrrdImage(e,"1234",{});a.renderImage(r,n)}}}},{key:"getSeriesData",value:function(e){var t={};if(e.isMultiframe?(t.isMultiframe=!0,t.numberOfSlices=e.imageIds.length,t.imageIndex=0,t.imageId=e.imageIds[t.imageIndex]):(t.isMultiframe=!1,t.numberOfSlices=e.imageIds.length,t.imageIndex=Math.floor(t.numberOfSlices/2),t.imageId=e.imageIds[t.imageIndex]),t.isColor=e.color,t.isTimeserie=!1,t.rows=e.instances[e.imageIds[0]].metadata.x00280010,t.cols=e.instances[e.imageIds[0]].metadata.x00280011,t.thickness=e.instances[e.imageIds[0]].metadata.x00180050,t.spacing_x=e.instances[e.imageIds[0]].metadata.x00280030?e.instances[e.imageIds[0]].metadata.x00280030[0]:null,t.spacing_y=e.instances[e.imageIds[0]].metadata.x00280030?e.instances[e.imageIds[0]].metadata.x00280030[1]:null,t.wc=e.instances[e.imageIds[0]].metadata.x00281050,t.ww=e.instances[e.imageIds[0]].metadata.x00281051,t.defaultWW=t.ww,t.defaultWC=t.wc,null!=t.rows&&null!=t.cols)return t;alert("invalid image metadata")}},{key:"updateData",value:function(e){var t=w.a.getEnabledElement(e).image,n=w.a.getViewport(e),a="".concat(t.width," x ").concat(t.height),r="W: ".concat(t.windowWidth.toFixed?t.windowWidth.toFixed(0):t.windowWidth," L: ").concat(t.windowWidth.toFixed?t.windowCenter.toFixed(0):t.windowCenter);this.setState({scale:n.scale,wwwc:r,imageDimensions:a})}},{key:"renderImage",value:function(e,t){var n,a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);if((n=this.getSeriesData(a)).imageId){var r=E.a.StackScrollTool,i={currentImageIdIndex:0,imageIds:a.imageIds};this.setState({slice:1,stackSize:a.imageIds.length});var o=this;w.a.loadImage(n.imageId).then((function(e){w.a.displayImage(t,e),o.updateData(t),E.a.addStackStateManager(t,["stack"]),E.a.addToolState(t,"stack",i),E.a.addTool(r);var n=w.a.colors.getColormap("gray"),a=w.a.getViewport(t);t.style.width=e.width,t.style.height=e.height,w.a.resize(t,!0),a.voi.windowWidth=e.windowWidth,a.voi.windowCenter=e.windowCenter,a.invert=e.invert,a.colormap=n,w.a.setViewport(t,a),w.a.fitToWindow(t)}))}else alert("Error during renderImage: imageId has not been loaded yet.")}},{key:"render",value:function(){var e=parseFloat(100*this.state.scale).toFixed(0);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{marginLeft:"20px"}}," ",r.a.createElement("p",{style:{float:"left"}},r.a.createElement("p",{style:{marginBottom:"10px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-mouse2-fill",viewBox:"0 0 16 16"},r.a.createElement("path",{d:"M7.5.026C4.958.286 3 2.515 3 5.188V5.5h4.5V.026zm1 0V5.5H13v-.312C13 2.515 11.042.286 8.5.026zM13 6.5H3v4.313C3 13.658 5.22 16 8 16s5-2.342 5-5.188V6.5z"}))," ",r.a.createElement("b",null,"Commands")," "),"Left Mouse Button: ",r.a.createElement("b",null,"WW/WC"),"; Right Mouse Button: ",r.a.createElement("b",null,"Zoom"),";"," ",r.a.createElement("br",null),"Mouse Scroll: ",r.a.createElement("b",null,"Change Slice"),"; Press Scroll Button: ",r.a.createElement("b",null,"Pan"),"."),w.a.getEnabledElements().length>0?r.a.createElement("p",{style:{marginRight:"30px",float:"right"}},r.a.createElement("b",null,"Zoom"),": ",e," %",r.a.createElement("br",null),r.a.createElement("b",null,"Window Width/Level"),": ",this.state.wwwc,r.a.createElement("br",null),r.a.createElement("b",null,"Image Dimensions"),": ",this.state.imageDimensions,r.a.createElement("br",null),r.a.createElement("b",null,"Slice Number"),": ",this.state.slice,"/",this.state.stackSize,r.a.createElement("br",null)):null),r.a.createElement("div",{className:"FlexboxLayout"},r.a.createElement("div",{className:p()("main-content")},r.a.createElement(b.a,{context:"ViewerMain"},r.a.createElement(y.a,{studies:this.props.studies,isStudyLoaded:this.props.isStudyLoaded})))))}}])&&O(n.prototype,a),i&&O(n,i),t}(a.Component);P(F,"propTypes",{studies:c.a.array,isStudyLoaded:c.a.bool,nrrdFile:c.a.object});var C=Object(g.J)(F);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t,n,a,r,i,o){try{var l=e[i](o),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function _(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var R=i.a.OHIFStudyMetadata,V=o.a.studyMetadataManager,H=function(e,t){return r.a.createElement(d.a,{onDrop:e,noDrag:!0},(function(e){var n=e.getRootProps,a=e.getInputProps;return r.a.createElement("span",B({},n(),{className:"link-dialog"}),t?r.a.createElement("span",null,"Load folders",r.a.createElement("input",B({},a(),{webkitdirectory:"true",mozdirectory:"true"}))):r.a.createElement("span",null,"Load files",r.a.createElement("input",a())))}))},J=function(e){function t(){var e,n,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,a=N(t).call(this),e=!a||"object"!==M(a)&&"function"!=typeof a?L(n):a,z(L(e),"updateStudies",(function(t){V.purge();var n=t.map((function(e){var t=new R(e,e.StudyInstanceUID),n=u.c.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||t.createDisplaySets(n),t.forEachDisplaySet((function(e){e.localFile=!0})),V.add(t),e}));e.setState({studies:n})})),e.state={studies:null,loading:!1,error:null,nrrdFile:null,scale:null,slice:null,stackSize:null,wwwc:null,size:null},e}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,e),n=t,(a=[{key:"render",value:function(){var e=this,t=function(){var t,n=(t=regeneratorRuntime.mark((function t(n){var a,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.setState({loading:!0}),!(a=n[0]).name.includes(".nrrd")){t.next=6;break}e.setState({studies:[],loading:!1,nrrdFile:a,isNrrdImage:!0}),t.next=13;break;case 6:return t.next=8,Object(m.a)(n);case 8:if(r=t.sent,i=e.updateStudies(r)){t.next=12;break}return t.abrupt("return");case 12:e.setState({studies:i,loading:!1,isNrrdImage:!1});case 13:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(a,r){var i=t.apply(e,n);function o(e){W(i,a,r,o,l,"next",e)}function l(e){W(i,a,r,o,l,"throw",e)}o(void 0)}))});return function(e){return n.apply(this,arguments)}}();return this.state.error?r.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):r.a.createElement(d.a,{onDrop:t,noClick:!0},(function(n){var a=n.getRootProps;return r.a.createElement("div",a(),e.state.studies&&!e.state.isNrrdImage?r.a.createElement(l.a,{studies:e.state.studies,studyInstanceUIDs:e.state.studies&&e.state.studies.map((function(e){return e.StudyInstanceUID})),isNrrdImage:e.state.isNrrdImage}):e.state.isNrrdImage&&e.state.nrrdFile?r.a.createElement(C,{studies:e.state.studies,isStudyLoaded:!0,nrrdFile:e.state.nrrdFile}):r.a.createElement("div",{className:"drag-drop-instructions"},r.a.createElement("div",{className:"drag-drop-contents"},e.state.loading?r.a.createElement("h3",null,"Loading..."):r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Drag and Drop DICOM files here to load them in the Viewer"),r.a.createElement("h4",null,function(e){return r.a.createElement(r.a.Fragment,null,"Or click to "," ",H(e)," "," or "," ",H(e,!0)," "," from dialog")}(t))))))}))}}])&&_(n.prototype,a),i&&_(n,i),t}(a.Component);z(J,"propTypes",{studies:c.a.array});t.default=J},1464:function(e,t,n){}}]);
//# sourceMappingURL=10.bundle.0f558d36f10d14d443d4.js.map