(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1435:function(e,t,n){"use strict";var r=n(19),i=n(0),a=n.n(i),o=n(1),s=n.n(o),u=n(28),c=n.n(u),l=n(22),p=n(407),d=n(766),f=n(11),m=n(6),v=n.n(m),y=n(102),h=(n(1446),n(268)),g=n(4),b=n.n(g),S=n(63),w=n.n(S),I=(0,b.a.import)("util/scrollToIndex"),D=l.a.redux.actions.setViewportSpecificData,E=Object(r.b)((function(e){var t=e.viewports,n=(t.viewportSpecificData[t.activeViewportIndex]||{}).cine;return{activeEnabledElement:h.a.runCommand("getActiveViewportEnabledElement"),activeViewportCineData:n||{isPlaying:!1,cineFrameRate:24},activeViewportIndex:e.viewports.activeViewportIndex}}),(function(e){return{dispatchSetViewportSpecificData:function(t,n){e(D(t,n))}}}),(function(e,t,n){var r=e.activeEnabledElement,i=e.activeViewportCineData,a=e.activeViewportIndex;return{cineFrameRate:i.cineFrameRate,isPlaying:i.isPlaying,onPlayPauseChanged:function(e){var n=w()(i);n.isPlaying=!n.isPlaying,t.dispatchSetViewportSpecificData(a,{cine:n})},onFrameRateChanged:function(e){var n=w()(i);n.cineFrameRate=e,t.dispatchSetViewportSpecificData(a,{cine:n})},onClickNextButton:function(){var e=b.a.getToolState(r,"stack");if(e&&e.data&&e.data.length){var t=e.data[0],n=t.currentImageIdIndex;n>=t.imageIds.length-1||I(r,n+1)}},onClickBackButton:function(){var e=b.a.getToolState(r,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].currentImageIdIndex;0!==t&&I(r,t-1)}},onClickSkipToStart:function(){var e=b.a.getToolState(r,"stack");e&&e.data&&e.data.length&&I(r,0)},onClickSkipToEnd:function(){var e=b.a.getToolState(r,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].imageIds.length-1;I(r,t)}}}}))(f.a),O=l.a.redux.actions,P=O.setLayout,R=O.setViewportActive,T=Object(r.b)((function(e){return{currentLayout:e.viewports.layout,activeViewportIndex:e.viewports.activeViewportIndex}}),(function(e){return{onChange:function(t,n,r){for(var i=[],a=t.row+1,o=t.col+1,s=a*o,u=0;u<s;u++){var c=n.viewports[u],l=c&&c.plugin;c&&c.vtk&&(l="cornerstone"),i.push({plugin:l})}var p={numRows:a,numColumns:o,viewports:i};r>s-1&&e(R(0)),e(P(p))}}}),(function(e,t){var n=t.onChange,r=e.currentLayout,i=e.activeViewportIndex;return{onChange:function(e){return n(e,r,i)}}}))(f.h),C=n(114);function x(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function(e){function t(e){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=U(t).call(this,e),n=!i||"object"!==j(i)&&"function"!=typeof i?A(r):i,V(A(n),"closeCineDialogIfNotApplicable",(function(){var e=n.props.dialog,t=n.state,r=t.dialogId,i=t.activeButtons,a=t.toolbarButtons;r&&(a.find((function(e){return e.options&&"CINE"===e.options.behavior}))||(e.dismiss({id:r}),i=i.filter((function(e){return e.options&&"CINE"!==e.options.behavior})),n.setState({dialogId:null,activeButtons:i})))}));var a=G.call(A(n));return n.state={toolbarButtons:a,activeButtons:[]},n.seriesPerStudyCount=[],n._handleBuiltIn=W.bind(A(n)),n._onDerivedDisplaySetsLoadedAndCached=n._onDerivedDisplaySetsLoadedAndCached.bind(A(n)),n.updateButtonGroups(),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,e),n=t,(r=[{key:"updateButtonGroups",value:function(){var e=this,t=h.c.modules[d.a.PANEL];this.buttonGroups={left:[],right:[]},t.forEach((function(t){var n=t.module,r=Array.from(n.defaultContext);n.menuOptions.forEach((function(t){var n=Array.from(t.context||r),i=e.props.activeContexts.some((function(e){return n.includes(e)})),a="function"==typeof t.isDisabled&&t.isDisabled(e.props.studies,e.props.activeViewport);if(i&&!a){var o={value:t.target,icon:t.icon,bottomLabel:t.label,badgeNumber:t.badgeNumber,stateEvent:t.stateEvent},s=t.from||"right";e.buttonGroups[s].push(o)}}))}))}},{key:"componentDidMount",value:function(){document.addEventListener("deriveddisplaysetsloadedandcached",this._onDerivedDisplaySetsLoadedAndCached)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("deriveddisplaysetsloadedandcached",this._onDerivedDisplaySetsLoadedAndCached)}},{key:"_onDerivedDisplaySetsLoadedAndCached",value:function(){this.updateButtonGroups(),this.setState({toolbarButtons:G.call(this)})}},{key:"componentDidUpdate",value:function(e){var t=e.activeContexts!==this.props.activeContexts,n=e.studies,r=e.activeViewport,i=this.props.activeViewport,a=this.props.studies,o=this.seriesPerStudyCount,s=!1;if(n.length!==a.length||r!==i)s=!0;else for(var u=0;u<a.length;u++)if(a[u].series.length!==o[u]){o[u]=a[u].series.length,s=!0;break}s&&this.updateButtonGroups(),t&&this.setState({toolbarButtons:G.call(this)},this.closeCineDialogIfNotApplicable)}},{key:"render",value:function(){var e=this,t=q.call(this,this.state.toolbarButtons,this.state.activeButtons),n=function(t,n){e.props.handleSidePanelChange(t,n)}.bind(this,"right");return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"ToolbarRow"},t,a.a.createElement(T,null),a.a.createElement("div",{className:"pull-right m-t-1 rm-x-1",style:{marginLeft:"auto"}},this.buttonGroups.right.length&&a.a.createElement(f.n,{options:this.buttonGroups.right,value:this.props.selectedRightSidePanel||"",onValueChanged:n}))))}}])&&k(n.prototype,r),i&&k(n,i),t}(i.Component);function _(e,t){var n=e.CustomComponent;if("function"==typeof n){var r=t.map((function(e){return e.id})),i=r.includes(e.id);return a.a.createElement(n,{parentContext:this,toolbarClickCallback:F.bind(this),button:e,key:e.id,activeButtons:r,isActive:i})}}function L(e,t){var n,r=this,i=e.buttons.map((function(e){return e.onClick=F.bind(r,e),t.map((function(e){return e.id})).indexOf(e.id)>-1&&(n=e.id),e}));return"Annotations"===e.id?a.a.createElement(f.f,{key:e.id,label:e.label,icon:e.icon,buttons:i,activeCommand:n,onGroupMenuClick:this.props.openMeasurementsPanel}):"SegTools"===e.id?a.a.createElement(f.f,{key:e.id,label:e.label,icon:"inline-edit",buttons:i,activeCommand:n,onGroupMenuClick:this.props.openSegmentationPanel}):a.a.createElement(f.f,{key:e.id,label:e.label,icon:e.icon,buttons:i,activeCommand:n})}function B(e,t){return a.a.createElement(f.A,{key:e.id,label:e.label,icon:e.icon,onClick:F.bind(this,e),isActive:t.map((function(e){return e.id})).includes(e.id)})}function q(e,t){var n=this;return e.map((function(e){var r=e.CustomComponent,i=e.buttons&&e.buttons.length;return r?_.call(n,e,t):i?L.call(n,e,t):B.call(n,e,t)}))}function F(e,t,n){var r=this.state.activeButtons;if(e.commandName){var i=Object.assign({evt:t},e.commandOptions);h.a.runCommand(e.commandName,i)}if("setToolActive"===e.type){var a=r.filter((function(e){var t=e.options;return t&&!t.togglable}));this.setState({activeButtons:[].concat(x(a),[e])})}else"builtIn"===e.type&&this._handleBuiltIn(e)}function G(){var e=this,t=h.c.modules[d.a.TOOLBAR],n=[];t.forEach((function(t){var r=t.module,i=r.definitions,a=r.defaultContext;i.forEach((function(t){var r=t.context||a;e.props.activeContexts.includes(r)&&n.push(t)}))}));var r=n.filter((function(e){return"Length"===e.id||"ArrowAnnotate"===e.id||"Angle"===e.id})),i=n.filter((function(e){return"More"===e.id}));if(0!==i.length){var a=i[0].buttons.filter((function(e){return"EllipticalRoi"===e.id||"RectangleRoi"===e.id||"Clear"===e.id||"Download"===e.id||"Bidirectional"===e.id})),o=i[0].buttons.filter((function(e){return"EllipticalRoi"!==e.id&&"RectangleRoi"!==e.id&&"Clear"!==e.id&&"Download"!==e.id&&"Bidirectional"!==e.id})),s={id:"Annotations",label:"Measurements",icon:"measure-target",buttons:r.concat(a)},u={id:"MoreTwo",label:"More",icon:"ellipse-circle",buttons:o};n.push(s),r.map((function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1);var r=n.indexOf(i[0]);-1!==r&&n.splice(r,1,u)}))}return n}function W(e){var t=this.props,n=t.dialog,r=t.t,i=this.state.dialogId,a=e.id,o=e.options;if("CINE"===o.behavior)if(i)n.dismiss({id:i}),this.setState((function(e){return{dialogId:null,activeButtons:x(e.activeButtons.filter((function(e){return e.id!==a})))}}));else{var s=document.querySelector(".ViewerMain").getBoundingClientRect(),u=s.x,c=s.y,l=n.create({content:E,defaultPosition:{x:u+20||0,y:c+20||0}});this.setState((function(t){return{dialogId:l,activeButtons:[].concat(x(t.activeButtons),[e])}}))}"DOWNLOAD_SCREEN_SHOT"===o.behavior&&h.a.runCommand("showDownloadViewportModal",{title:r("Download High Quality Image")})}V(N,"propTypes",{isLeftSidePanelOpen:s.a.bool.isRequired,isRightSidePanelOpen:s.a.bool.isRequired,selectedLeftSidePanel:s.a.string.isRequired,selectedRightSidePanel:s.a.string.isRequired,handleSidePanelChange:s.a.func.isRequired,openMeasurementsPanel:s.a.func.isRequired,openSegmentationPanel:s.a.func.isRequired,activeContexts:s.a.arrayOf(s.a.string).isRequired,studies:s.a.array,t:s.a.func.isRequired,dialog:s.a.any,modal:s.a.any}),V(N,"defaultProps",{studies:[]});var Y=Object(y.d)(["Common","ViewportDownloadForm"])(Object(f.K)(Object(f.J)(Object(C.e)(N))));var J=n(424),H=l.a.redux.actions.setActiveViewportSpecificData,z=Object(r.b)(null,(function(e,t){return{onThumbnailClick:function(n){var r=function(e,t){return Array.isArray(e)&&e.reduce((function(e,t){var n=[];return t&&Array.isArray(t.displaySets)&&(n=t.displaySets),e.concat(n)}),[]).find((function(e){return e.displaySetInstanceUID===t}))||null}(t.studyMetadata,n),i=h.d.services,a=i.LoggerService,o=i.UINotificationService;if(r.isDerived){var s=r.Modality;if("SEG"===s&&h.d){var u=r.getSourceDisplaySet(t.studyMetadata,!0,(function(e){a.error({error:e,message:e.message}),o.show({title:"DICOM Segmentation Loader",message:e.message,type:"error",autoClose:!0})}));r=u.referencedDisplaySet,u.activatedLabelmapPromise.then((function(e){var t=new CustomEvent("extensiondicomsegmentationsegselected",{detail:{activatedLabelmapIndex:e}});document.dispatchEvent(t)}))}else r=r.getSourceDisplaySet(t.studyMetadata);if(!r){var c=new Error("Referenced series for ".concat(s," dataset not present.")),l="Referenced series for ".concat(s," dataset not present.");a.error({error:c,message:l}),o.show({autoClose:!1,title:"Fail to load series",message:l,type:"error"})}}if(!r){var p=new Error("Source data not present");a.error({error:p,message:"Source data not present"}),o.show({autoClose:!1,title:"Fail to load series",message:"Source data not present",type:"error"})}if(!1===r.isSOPClassUIDSupported){var d=new Error("Modality not supported");a.error({error:d,message:"Modality not supported"}),o.show({autoClose:!1,title:"Fail to load series",message:"Modality not supported",type:"error"})}e(H(r))}}}))(J.a),K=n(1440),Q=(n(1451),function(e){var t=e.from,n=e.isOpen,r=e.children,i=e.width,o="right"===t?"from-right":"from-left",s=i?{maxWidth:i,marginRight:n?"0":-1*Number.parseInt(i)}:{};return a.a.createElement("section",{style:s,className:c()("sidepanel",o,{"is-open":n})},r)});Q.propTypes={from:s.a.string.isRequired,isOpen:s.a.bool.isRequired,children:s.a.node,width:s.a.string};var X=Q,Z=n(1443),$=n(120),ee=(n(1439),n(203)),te=n(202),ne=n(3),re=n.n(ne),ie=(n(1453),function(e){var t=e.studies,n=e.options;return Object(i.useEffect)((function(){var e=ee.a.StudyPrefetcher.getInstance(t,n),r=t.map((function(e){return te.a.studyMetadataManager.get(e.StudyInstanceUID)}));e.setStudies(r);var i=function(n){var r=n.detail;if(!r.image.imageId.includes("nrrdLoader")){var i=t.map((function(e){var t=te.a.studyMetadataManager.get(e.StudyInstanceUID),n=t.getDisplaySets();return(!n||n.length<1)&&e.displaySets.forEach((function(e){return t.addDisplaySet(e)})),t}));e.setStudies(i);var a=e.getStudy(r.image),o=e.getSeries(a,r.image),s=e.getInstance(o,r.image);if(a.displaySets&&a.displaySets.length>0){var u=e.getDisplaySetBySOPInstanceUID(a.displaySets,s).displaySetInstanceUID;e.prefetch(r.element,u)}}},a=function(e){e.detail.element.addEventListener(re.a.EVENTS.NEW_IMAGE,i)};return re.a.events.addEventListener(re.a.EVENTS.ELEMENT_ENABLED,a),function(){re.a.events.removeEventListener(re.a.EVENTS.ELEMENT_ENABLED,a),e.destroy()}}),[n,t]),null});ie.propTypes={studies:s.a.array.isRequired,options:s.a.shape({enabled:s.a.bool,order:s.a.string,displaySetCount:s.a.number,preventCache:s.a.bool,prefetchDisplaySetsTimeout:s.a.number,includeActiveDisplaySet:s.a.bool})},ie.defaultProps={options:{order:"closest",displaySetCount:1,preventCache:!1,prefetchDisplaySetsTimeout:300,includeActiveDisplaySet:!1}};var ae=ie,oe=l.a.classes.StudyLoadingListener,se=function(e){var t=e.studies;return Object(i.useEffect)((function(){var e=oe.getInstance();return t&&t.length>0&&(e.clear(),e.addStudies(t)),function(){e.clear()}}),[t]),null};function ue(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function ce(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ue(a,r,i,o,s,"next",e)}function s(e){ue(a,r,i,o,s,"throw",e)}o(void 0)}))}}function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function me(e,t){return(me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ye=l.a.utils.studyMetadataManager,he=function(e){function t(e){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=de(t).call(this,e),n=!i||"object"!==le(i)&&"function"!=typeof i?fe(r):i,ve(fe(n),"state",{isLeftSidePanelOpen:!0,isRightSidePanelOpen:!1,selectedRightSidePanel:"",selectedLeftSidePanel:"studies",thumbnails:[],openMeasurements:!1}),ve(fe(n),"retrieveTimepoints",(function(e){l.a.log.info("retrieveTimepoints");var t=(new Date).toISOString(),r=(new Date).toISOString();return n.props.studies&&(r=new Date("1000-01-01").toISOString(),n.props.studies.forEach((function(e){var n=v()(e.StudyDate,"YYYYMMDD").toISOString();n<t&&(t=n),n>r&&(r=n)}))),Promise.resolve([{timepointType:"baseline",timepointId:"TimepointId",studyInstanceUIDs:n.props.studyInstanceUIDs,PatientID:e.PatientID,earliestDate:t,latestDate:r,isLocked:!1}])})),ve(fe(n),"storeTimepoints",(function(e){return l.a.log.info("storeTimepoints"),Promise.resolve()})),ve(fe(n),"updateTimepoint",(function(e,t){return l.a.log.info("updateTimepoint"),Promise.resolve()})),ve(fe(n),"removeTimepoint",(function(e){return l.a.log.info("removeTimepoint"),Promise.resolve()})),ve(fe(n),"disassociateStudy",(function(e,t){return l.a.log.info("disassociateStudy"),Promise.resolve()})),ve(fe(n),"onTimepointsUpdated",(function(e){n.props.onTimepointsUpdated&&n.props.onTimepointsUpdated(e)})),ve(fe(n),"onMeasurementsUpdated",(function(e){n.props.onMeasurementsUpdated&&n.props.onMeasurementsUpdated(e)}));var a=n.props.activeServer,o=Object.assign({},a),s={servicesManager:h.d};return l.a.measurements.MeasurementApi.setConfiguration({dataExchange:{retrieve:function(e){return p.a.retrieveMeasurements(e,s)},store:p.a.storeMeasurements},server:o}),l.a.measurements.TimepointApi.setConfiguration({dataExchange:{retrieve:n.retrieveTimepoints,store:n.storeTimepoints,remove:n.removeTimepoint,update:n.updateTimepoint,disassociate:n.disassociateStudy}}),n._getActiveViewport=n._getActiveViewport.bind(fe(n)),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&me(e,t)}(t,e),n=t,(r=[{key:"componentWillUnmount",value:function(){this.props.dialog&&this.props.dialog.dismissAll(),document.removeEventListener("segmentationLoadingError",this._updateThumbnails)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.studies,n=e.isStudyLoaded,r=e.reload,i=e.isNrrdImage;if(r&&window.location.reload(!1),!0===i)this.setState({thumbnails:[]});else{var a=l.a.measurements,o=a.TimepointApi,s=a.MeasurementApi,u=new o("TimepointId",{onTimepointsUpdated:this.onTimepointsUpdated}),c=new s(u,{onMeasurementsUpdated:this.onMeasurementsUpdated});if(this.currentTimepointId="TimepointId",this.timepointApi=u,this.measurementApi=c,t){var p=t[0]&&t[0].PatientID;u.retrieveTimepoints({PatientID:p}),n&&this.measurementApi.retrieveMeasurements(p,["TimepointId"]);var d=this.props.viewports[this.props.activeViewportIndex],f=d?d.displaySetInstanceUID:void 0;this.setState({thumbnails:Ie(t,f)})}document.addEventListener("segmentationLoadingError",this._updateThumbnails.bind(this),!1)}}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.studies,r=t.isStudyLoaded,i=t.activeViewportIndex,a=t.viewports;t.reload&&window.location.reload(!1);var o=a[i],s=o?o.displaySetInstanceUID:void 0,u=e.viewports[e.activeViewportIndex],c=u?u.displaySetInstanceUID:void 0;if(n===e.studies&&i===e.activeViewportIndex&&s===c||this.setState({thumbnails:Ie(n,s),activeDisplaySetInstanceUID:s}),r&&r!==e.isStudyLoaded){var l=n[0]&&n[0].PatientID,p=this.currentTimepointId;this.timepointApi.retrieveTimepoints({PatientID:l}),this.measurementApi.retrieveMeasurements(l,[p])}}},{key:"_updateThumbnails",value:function(){var e=this.props,t=e.studies,n=e.activeViewportIndex,r=e.viewports[n],i=r?r.displaySetInstanceUID:void 0;this.setState({thumbnails:Ie(t,i),activeDisplaySetInstanceUID:i})}},{key:"_getActiveViewport",value:function(){return this.props.viewports[this.props.activeViewportIndex]}},{key:"_openMeasurementsPanel",value:function(){var e=null;return h.c.modules[d.a.PANEL].forEach((function(t){t.module.components.forEach((function(t){"measurement-panel"===t.id&&(e=t.component)}))})),e}},{key:"render",value:function(){var e,t=this,n=null;return this.state.openMeasurements&&"measurement-panel"===this.state.selectedRightSidePanel?n=this._openMeasurementsPanel():h.c.modules[d.a.PANEL].forEach((function(r){r.module.components.forEach((function(r){r.id===t.state.selectedRightSidePanel?n=r.component:r.id===t.state.selectedLeftSidePanel&&(e=r.component)}))})),a.a.createElement(a.a.Fragment,null,a.a.createElement(Z.a,{context:"ToolbarRow"},a.a.createElement(Y,{activeViewport:this.props.viewports[this.props.activeViewportIndex],isLeftSidePanelOpen:this.state.isLeftSidePanelOpen,isRightSidePanelOpen:this.state.isRightSidePanelOpen,selectedLeftSidePanel:this.state.isLeftSidePanelOpen?this.state.selectedLeftSidePanel:"",selectedRightSidePanel:this.state.isRightSidePanelOpen?this.state.selectedRightSidePanel:"",openMeasurementsPanel:function(){return t.setState({openMeasurements:!0,isRightSidePanelOpen:!0,selectedRightSidePanel:"measurement-panel"})},openSegmentationPanel:function(){return t.setState({isRightSidePanelOpen:!0,selectedRightSidePanel:"segmentation-panel"})},handleSidePanelChange:function(e,n){var r=e&&e[0].toUpperCase()+e.slice(1),i="is".concat(r,"SidePanelOpen"),a="selected".concat(r,"SidePanel"),o=Object.assign({},t.state),s=o[i],u=o[a],c=u===n||null===n;o[a]=n||u,(!s||c)&&(o[i]=!o[i]),t.setState(o)},studies:this.props.studies})),a.a.createElement(C.c.Consumer,null,(function(){return a.a.createElement(se,{studies:t.props.studies})})),a.a.createElement("div",{className:"FlexboxLayout"},a.a.createElement(Z.a,{context:"LeftSidePanel"},a.a.createElement(X,{from:"left",isOpen:this.state.isLeftSidePanelOpen},e?a.a.createElement(e,{viewports:this.props.viewports,studies:this.props.studies,activeIndex:this.props.activeViewportIndex}):a.a.createElement(C.c.Consumer,null,(function(e){var n=e.appConfig.studyPrefetcher,r=t.state.thumbnails;return a.a.createElement(z,{studies:r,studyMetadata:t.props.studies,showThumbnailProgressBar:n&&n.enabled&&n.displayProgress})})))),a.a.createElement("div",{className:c()("main-content")},a.a.createElement(Z.a,{context:"ViewerMain"},a.a.createElement(C.c.Consumer,null,(function(e){var n=e.appConfig.studyPrefetcher,r=t.props.studies;return n&&n.enabled&&a.a.createElement(ae,{studies:r,options:n})})),a.a.createElement(K.a,{studies:this.props.studies,isStudyLoaded:this.props.isStudyLoaded}))),a.a.createElement(Z.a,{context:"RightSidePanel"},a.a.createElement(X,{from:"right",isOpen:this.state.isRightSidePanelOpen},n&&a.a.createElement(n,{isOpen:this.state.isRightSidePanelOpen,viewports:this.props.viewports,studies:this.props.studies,activeIndex:this.props.activeViewportIndex,activeViewport:this.props.viewports[this.props.activeViewportIndex],getActiveViewport:this._getActiveViewport})))))}}])&&pe(n.prototype,r),i&&pe(n,i),t}(i.Component);ve(he,"propTypes",{studies:s.a.arrayOf(s.a.shape({StudyInstanceUID:s.a.string.isRequired,StudyDate:s.a.string,PatientID:s.a.string,displaySets:s.a.arrayOf(s.a.shape({displaySetInstanceUID:s.a.string.isRequired,SeriesDescription:s.a.string,SeriesNumber:s.a.number,InstanceNumber:s.a.number,numImageFrames:s.a.number,Modality:s.a.string.isRequired,images:s.a.arrayOf(s.a.shape({getImageId:s.a.func.isRequired}))}))})),studyInstanceUIDs:s.a.array,activeServer:s.a.shape({type:s.a.string,wadoRoot:s.a.string}),onTimepointsUpdated:s.a.func,onMeasurementsUpdated:s.a.func,viewports:s.a.object.isRequired,activeViewportIndex:s.a.number.isRequired,isStudyLoaded:s.a.bool,reload:s.a.bool,dialog:s.a.object,isNrrdImage:s.a.bool});var ge=Object(f.J)(he),be=function(){var e=ce(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,t.Modality&&!["SEG","SR","RTSTRUCT","RTDOSE"].includes(t.Modality)&&(i=ye.get(n.StudyInstanceUID),a=i.getDerivedDatasets({referencedSeriesInstanceUID:t.SeriesInstanceUID}),r=a.length),e.abrupt("return",r>0);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Se=function(){var e=ce(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.inconsistencyWarnings){e.next=2;break}return e.abrupt("return",t.inconsistencyWarnings);case 2:return n=[],"SEG"!==t.Modality?(t.reconstructionIssues&&0!==t.reconstructionIssues.length&&(t.reconstructionIssues.forEach((function(e){switch(e){case $.a.DATASET_4D:n.push("The dataset is 4D.");break;case $.a.VARYING_IMAGESDIMENSIONS:n.push("The dataset frames have different dimensions (rows, columns).");break;case $.a.VARYING_IMAGESCOMPONENTS:n.push("The dataset frames have different components (Sample per pixel).");break;case $.a.VARYING_IMAGESORIENTATION:n.push("The dataset frames have different orientation.");break;case $.a.IRREGULAR_SPACING:n.push("The dataset frames have different pixel spacing.");break;case $.a.MULTIFFRAMES:n.push("The dataset is a multiframes.")}})),n.push("The datasets is not a reconstructable 3D volume. MPR mode is not available.")),t.missingFrames&&(!t.reconstructionIssues||t.reconstructionIssues&&!t.reconstructionIssues.find((function(e){return e===$.a.DATASET_4D})))&&n.push("The datasets is missing frames: "+t.missingFrames+"."),!1===t.isSOPClassUIDSupported&&n.push("The datasets is not supported."),t.inconsistencyWarnings=n):t.loadError&&(n.push(t.segLoadErrorMessagge),t.inconsistencyWarnings=n),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=function(e,t,n){var r=!1,i=e.displaySetInstanceUID;if("SEG"!==e.Modality&&"RTSTRUCT"!==e.Modality&&"RTDOSE"!==e.Modality)r=n===i;else if(e.getSourceDisplaySet)if("SEG"===e.Modality){var a=e.getSourceDisplaySet(t,!1).referencedDisplaySet;r=!!a&&n===a.displaySetInstanceUID}else{var o=e.getSourceDisplaySet(t,!1);r=!!o&&n===o.displaySetInstanceUID}return r},Ie=function(e,t){return e.map((function(n){var r=n.StudyInstanceUID,i=[];return n.displaySets.map((function(r){if("SR"!==r.Modality&&"SEG"!==r.Modality){var a,o=r.displaySetInstanceUID,s=r.SeriesDescription,u=r.numImageFrames,c=r.SeriesNumber;if(r.images&&r.images.length){var l=Math.floor(r.images.length/2);a=r.images[l].getImageId()}var p=Se(r),d=be(r,n);i.push({active:we(r,e,t),imageId:a,altImageText:void 0,displaySetInstanceUID:o,SeriesDescription:s,numImageFrames:u,SeriesNumber:c,hasWarnings:p,hasDerivedDisplaySets:d})}})),{StudyInstanceUID:r,thumbnails:i}}))},De=l.a.redux.actions,Ee=De.setTimepoints,Oe=De.setMeasurements,Pe=function(e){return e.servers.find((function(e){return!0===e.active}))},Re=Object(r.b)((function(e){var t=e.viewports,n=e.servers;return{viewports:t.viewportSpecificData,activeViewportIndex:t.activeViewportIndex,activeServer:Pe(n)}}),(function(e){return{onTimepointsUpdated:function(t){e(Ee(t))},onMeasurementsUpdated:function(t){e(Oe(t))}}}))(ge);t.a=Re},1439:function(e,t,n){},1440:function(e,t,n){"use strict";var r=n(22),i=(n(1447),n(268)),a=n(0),o=n.n(a),s=(n(1448),n(1)),u=n.n(s),c=n(28),l=n.n(c),p=n(202),d=n(11),f=n(311);n(1449);function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var v=function(e){var t=e.children,n=e.onDrop,r=e.viewportIndex,i=e.className,a=m(Object(f.d)({accept:"thumbnail",drop:function(e,t){var i=t.canDrop(),a=t.isOver();if(i&&a&&n){var o=e.StudyInstanceUID,s=e.displaySetInstanceUID;n({viewportIndex:r,StudyInstanceUID:o,displaySetInstanceUID:s})}},collect:function(e){return{highlighted:e.canDrop(),hovered:e.isOver()}}}),2),s=a[0],u=s.hovered,c=s.highlighted,p=a[1];return o.a.createElement("div",{className:l()("viewport-drop-target",{hovered:u},{highlighted:c},i),ref:p,"data-cy":"viewport-container-".concat(r)},t)};v.propTypes={children:u.a.node.isRequired,viewportIndex:u.a.number.isRequired,onDrop:u.a.func.isRequired,className:u.a.string};var y=v;var h=n(1450),g=n.n(h),b=p.a.loadAndCacheDerivedDisplaySets,S=function(e){var t=e.activeViewportIndex,n=e.availablePlugins,r=e.defaultPlugin,i=e.layout,s=e.numRows,u=e.numColumns,c=e.setViewportData,p=e.studies,f=e.viewportData,m=e.children,v=e.isStudyLoaded,h=100/s,S=100/u;if(!f||!f.length)return null;var w=Object(d.I)(),I=Object(d.G)();Object(a.useEffect)((function(){v&&f.forEach((function(e){b(e,p,I,w)}))}),[p,f,v,w,I]);var D=o.a.useMemo((function(){return i.viewports.map((function(e,i){var a=f[i];if(!a)return null;var s={displaySet:a,studies:p},u=!e.plugin&&a&&a.plugin?a.plugin:e.plugin,d=function(e,t,n,r,i,a){if(e.displaySet){var s=r[i=i||a];if(!s)throw new Error("No Viewport Component available for name ".concat(i,".\n         Available plugins: ").concat(JSON.stringify(r)));return o.a.createElement(s,{viewportData:e,viewportIndex:t,children:[n]})}return o.a.createElement(g.a,null)}(s,i,m,n,u,r);return o.a.createElement(y,{onDrop:c,viewportIndex:i,className:l()("viewport-container",{active:t===i}),key:i},d)}))}),[i,f,p,m,n,r,c,t]);return o.a.createElement("div",{"data-cy":"viewprt-grid",style:{display:"grid",gridTemplateRows:"repeat(".concat(s,", ").concat(h,"%)"),gridTemplateColumns:"repeat(".concat(u,", ").concat(S,"%)"),height:"100%",width:"100%"}},D)};S.propTypes={viewportData:u.a.array.isRequired,supportsDrop:u.a.bool.isRequired,activeViewportIndex:u.a.number.isRequired,layout:u.a.object.isRequired,availablePlugins:u.a.object.isRequired,setViewportData:u.a.func.isRequired,studies:u.a.array,children:u.a.node,defaultPlugin:u.a.string,numRows:u.a.number.isRequired,numColumns:u.a.number.isRequired},S.defaultProps={viewportData:[],numRows:1,numColumns:1,layout:{viewports:[{}]},activeViewportIndex:0,supportsDrop:!0,availablePlugins:{DefaultViewport:function(e){return React.createElement("div",null,JSON.stringify(e))}},defaultPlugin:"defaultViewportPlugin"};var w=S,I=n(766),D=n(19),E=n(799),O=n.n(E),P=O()((function(e){var t={};return e.forEach((function(e){t[e.extensionId]=e.module})),t})),R=Object(D.b)((function(e){var t,n=i.c.modules[I.a.VIEWPORT],r=P(n);n.length&&(t=n[0].extensionId);var a=e.viewports;return{numRows:a.numRows,numColumns:a.numColumns,layout:a.layout,activeViewportIndex:a.activeViewportIndex,availablePlugins:r,defaultPlugin:t}}),null)(w),T=n(1438),C=n.n(T);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=n(800),N=O()(C.a),_=function(e){function t(e){var n,r,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=k(t).call(this,e),n=!a||"object"!==x(a)&&"function"!=typeof a?U(r):a,M(U(n),"fillEmptyViewportPanes",(function(){var e=[],t=n.props,r=t.layout,i=t.viewportSpecificData,a=n.state.displaySets;if(a&&a.length){for(var o=0;o<r.viewports.length;o++){var s=i[o];if(s&&s.StudyInstanceUID&&s.displaySetInstanceUID)e.push({StudyInstanceUID:s.StudyInstanceUID,displaySetInstanceUID:s.displaySetInstanceUID});else{var u=a.find((function(t){return!e.some((function(e){return e.displaySetInstanceUID===t.displaySetInstanceUID}))}))||a[a.length-1];e.push(u)}}e.forEach((function(e,t){e&&e.StudyInstanceUID&&n.setViewportData({viewportIndex:t,StudyInstanceUID:e.StudyInstanceUID,displaySetInstanceUID:e.displaySetInstanceUID})}))}})),M(U(n),"setViewportData",(function(e){var t=e.viewportIndex,r=e.StudyInstanceUID,a=e.displaySetInstanceUID,o=n.findDisplaySet(n.props.studies,r,a),s=i.d.services,u=s.LoggerService,c=s.UINotificationService;if(o.isDerived){if("SEG"===o.Modality&&i.d){var l=o.getSourceDisplaySet(n.props.studies,!0,(function(e){u.error({error:e,message:e.message}),c.show({title:"DICOM Segmentation Loader",message:e.message,type:"error",autoClose:!0})}));o=l.referencedDisplaySet,l.activatedLabelmapPromise.then((function(e){var t=new CustomEvent("extensiondicomsegmentationsegselected",{detail:{activatedLabelmapIndex:e}});document.dispatchEvent(t)}))}else o=o.getSourceDisplaySet(n.props.studies);if(!o){var p=new Error("Source data not present"),d="Source data not present";u.error({error:p,message:d}),c.show({autoClose:!1,title:"Fail to load series",message:d,type:"error"})}}if(!1===o.isSOPClassUIDSupported){var f=new Error("Modality not supported");u.error({error:f,message:"Modality not supported"}),c.show({autoClose:!1,title:"Fail to load series",message:"Modality not supported",type:"error"})}n.props.setViewportSpecificData(t,o)})),n.state={displaySets:[]},V.registerNRRDImageLoader(),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,e),n=t,(r=[{key:"getDisplaySets",value:function(e){var t=[];return e.forEach((function(e){e.displaySets.forEach((function(e){e.plugin||(e.plugin="cornerstone"),t.push(e)}))})),t}},{key:"findDisplaySet",value:function(e,t,n){var r=e.find((function(e){return e.StudyInstanceUID===t}));if(r)return r.displaySets.find((function(e){return e.displaySetInstanceUID===n}))}},{key:"componentDidMount",value:function(){if(this.props.studies){var e=this.getDisplaySets(this.props.studies);this.setState({displaySets:e},this.fillEmptyViewportPanes)}}},{key:"componentDidUpdate",value:function(e){var t=e.layout.viewports.length,n=this.props.layout.viewports.length,r=this.props.layout.viewports.some((function(e){return!!e.vtk}));if(this.props.studies!==e.studies||n!==t&&!r){var i=this.getDisplaySets(this.props.studies);this.setState({displaySets:i},this.fillEmptyViewportPanes)}}},{key:"render",value:function(){var e=this.props.viewportSpecificData,t=N(e);return o.a.createElement("div",{className:"ViewerMain"},this.state.displaySets.length&&o.a.createElement(R,{isStudyLoaded:this.props.isStudyLoaded,studies:this.props.studies,viewportData:t,setViewportData:this.setViewportData}))}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.viewportSpecificData;Object.keys(t).forEach((function(t){e.props.clearViewportSpecificData(t)}))}}])&&j(n.prototype,r),a&&j(n,a),t}(a.Component);M(_,"propTypes",{activeViewportIndex:u.a.number.isRequired,studies:u.a.array,viewportSpecificData:u.a.object.isRequired,layout:u.a.object.isRequired,setViewportSpecificData:u.a.func.isRequired,clearViewportSpecificData:u.a.func.isRequired,isStudyLoaded:u.a.bool});var L=_,B=r.a.redux.actions,q=B.setViewportSpecificData,F=B.clearViewportSpecificData,G=Object(D.b)((function(e){var t=e.viewports;return{activeViewportIndex:t.activeViewportIndex,layout:t.layout,viewportSpecificData:t.viewportSpecificData,viewports:e.viewports}}),(function(e){return{setViewportSpecificData:function(t,n){e(q(t,n))},clearViewportSpecificData:function(){e(F())}}}))(L);t.a=G},1441:function(e,t,n){"use strict";var r=n(29),i=n.n(r);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(n="fileType")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"loadFile",value:function(e,t){}},{key:"getDataset",value:function(e,t){}},{key:"getStudies",value:function(e,t){}}])&&a(t.prototype,n),r&&a(t,r),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=new(function(e){function t(){var e,n,r,i,a,o,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var p=arguments.length,d=new Array(p),f=0;f<p;f++)d[f]=arguments[f];return r=this,n=!(i=(e=c(t)).call.apply(e,[this].concat(d)))||"object"!==s(i)&&"function"!=typeof i?l(r):i,a=l(n),u="application/pdf",(o="fileType")in a?Object.defineProperty(a,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[o]=u,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,e),n=t,(r=[{key:"loadFile",value:function(e,t){return i.a.wadouri.loadFileRequest(t)}},{key:"getDataset",value:function(e,t){var n={};return n.imageId=e.imageId||t,n}},{key:"getStudies",value:function(e,t){return this.getDefaultStudy(t)}},{key:"getDefaultStudy",value:function(e){return{StudyInstanceUID:"",StudyDate:"",StudyTime:"",AccessionNumber:"",ReferringPhysicianName:"",PatientName:"",PatientID:"",PatientBirthdate:"",PatientSex:"",StudyId:"",StudyDescription:"",series:[{SeriesInstanceUID:"",SeriesDescription:"",SeriesNumber:"",instances:[{metadata:{SOPInstanceUID:"",SOPClassUID:"1.2.840.10008.5.1.4.1.1.104.1",Rows:"",Columns:"",NumberOfFrames:0,InstanceNumber:1},getImageId:function(){return e},isLocalFile:!0}]}]}}}])&&u(n.prototype,r),a&&u(n,a),t}(o)),f=n(47);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=n(22).a.cornerstone.metadataProvider,S=new(function(e){function t(){var e,n,r,i,a,o,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var u=arguments.length,c=new Array(u),l=0;l<u;l++)c[l]=arguments[l];return r=this,n=!(i=(e=y(t)).call.apply(e,[this].concat(c)))||"object"!==m(i)&&"function"!=typeof i?h(r):i,a=h(n),s="application/dicom",(o="fileType")in a?Object.defineProperty(a,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[o]=s,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,e),n=t,(r=[{key:"loadFile",value:function(e,t){return i.a.wadouri.loadFileRequest(t)}},{key:"getDataset",value:function(e,t){var n={};try{var r=f.b.data.DicomMessage.readFile(e);n=f.b.data.DicomMetaDictionary.naturalizeDataset(r.dict),b.addInstance(n),n._meta=f.b.data.DicomMetaDictionary.namifyDataset(r.meta)}catch(e){console.error("Error reading dicom file",e)}return n.imageId=t,n}},{key:"getStudies",value:function(e,t){return this.getStudyFromDataset(e)}},{key:"getStudyFromDataset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.StudyInstanceUID,n=e.StudyDate,r=e.StudyTime,i=e.AccessionNumber,a=e.ReferringPhysicianName,o=e.PatientName,s=e.PatientID,u=e.PatientBirthDate,c=e.PatientSex,l=e.StudyID,p=e.StudyDescription,d=e.SeriesInstanceUID,f=e.SeriesDescription,m=e.SeriesNumber,v=e.imageId,y={metadata:e,url:v},h={SeriesInstanceUID:d,SeriesDescription:f,SeriesNumber:m,instances:[y]},g={StudyInstanceUID:t,StudyDate:n,StudyTime:r,AccessionNumber:i,ReferringPhysicianName:a,PatientName:o,PatientID:s,PatientBirthDate:u,PatientSex:c,StudyID:l,StudyDescription:p,series:[h]};return g}}])&&v(n.prototype,r),a&&v(n,a),t}(o));function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(e){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,n=!(i=O(t).call(this))||"object"!==w(i)&&"function"!=typeof i?P(r):i,T(P(n),"fileType",void 0),T(P(n),"loader",void 0);var a=e&&e.type;return n.loader=n.getLoader(a),n.fileType=n.loader.fileType,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,e),n=t,a=[{key:"groupSeries",value:function(e){var t=function(e,t,n){var r=1;return e.reduce((function(e,i){var a,o=i[t],s=i[n];return e[o=o||""+r++]||(e[o]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},i),e[o][n]=[]),(a=e[o][n]).push.apply(a,I(s)),e}),{})};return Object.values(t(e,"StudyInstanceUID","series")).map((function(e){var n=t(e.series,"SeriesInstanceUID","instances");return e.series=Object.values(n),e}))}}],(r=[{key:"addFile",value:function(e){return i.a.wadouri.fileManager.add(e)}},{key:"loadFile",value:function(e,t){return this.loader.loadFile(e,t)}},{key:"getDataset",value:function(e,t){return this.loader.getDataset(e,t)}},{key:"getStudies",value:function(e,t){return this.loader.getStudies(e,t)}},{key:"getLoader",value:function(e){return"application/pdf"===e?d:S}}])&&E(n.prototype,r),a&&E(n,a),t}(o);function x(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){x(a,r,i,o,s,"next",e)}function s(e){x(a,r,i,o,s,"throw",e)}o(void 0)}))}}n.d(t,"a",(function(){return U}));var k=function(){var e=j(regeneratorRuntime.mark((function e(t){var n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new C(t),r=n.addFile(t),e.next=5,n.loadFile(t,r);case 5:return i=e.sent,e.next=8,n.getDataset(i,r);case 8:return a=e.sent,e.next=11,n.getStudies(a,r);case 11:return o=e.sent,e.abrupt("return",o);case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0.name,":Error when trying to load and process local files:",e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}();function U(e){return A.apply(this,arguments)}function A(){return(A=j(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map(k),e.next=3,Promise.all(n);case 3:return r=e.sent,e.abrupt("return",C.groupSeries(r.flat()));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1443:function(e,t,n){"use strict";var r=n(0),i=n.n(r),a=n(28),o=n.n(a),s=n(1),u=n.n(s),c=n(11),l=n(268);n(1452);function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var d=l.d.services.UIModalService,f=function(e){var t=e.context,n=e.children;return i.a.createElement(c.d,{fallbackComponent:function(){return i.a.createElement("div",{className:"ErrorFallback",role:"alert"},i.a.createElement("p",null,"Error rendering ",t,". ",i.a.createElement("br",null)," Check the browser console for more details."))},context:t,onError:function(e,n){d.show({content:function(){var a=p(Object(r.useState)(!1),2),s=a[0],u=a[1];return i.a.createElement("div",{className:"ErrorFallback",role:"alert"},i.a.createElement("div",{className:"ErrorBoundaryDialog"},i.a.createElement("h3",{className:"ErrorBoundaryDialogTitle"},t,": ",i.a.createElement("span",null,e.message))),i.a.createElement("button",{className:"btn btn-primary btn-sm ErrorBoundaryDialogButton",onClick:function(){return u((function(e){return!e}))}},i.a.createElement(c.g,{name:"chevron-down",className:o()("ErrorBoundaryDialogIcon",{opened:s})}),"Stack Trace"),s&&i.a.createElement("pre",null,n))},title:"Something went wrong in ".concat(t)})}},n)};f.propTypes={context:u.a.string.isRequired,children:u.a.node};var m=f;t.a=m},1446:function(e,t,n){},1447:function(e,t,n){},1448:function(e,t,n){},1449:function(e,t,n){},1450:function(e,t){},1451:function(e,t,n){},1452:function(e,t,n){},1453:function(e,t,n){}}]);
//# sourceMappingURL=0.bundle.7dd0ac998e86b8f2fb1b.js.map