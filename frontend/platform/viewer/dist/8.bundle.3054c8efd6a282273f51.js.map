{"version":3,"sources":["webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/utils/formatStudy.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/components/OHIFCornerstoneViewportOverlay.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/tools/constants/toolNames.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/tools/constants/scoordTypes.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/tools/DICOMSRDisplayTool.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/tools/initSRTools.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/tools/utils/getToolAlias.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/ConnectedCornerstoneViewport.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/tools/checkForSRAnnotations.js","webpack:///D:/tese/Bia_final/frontend_bia/extensions/cornerstone/src/OHIFCornerstoneViewport.js"],"names":["formatNumberPrecision","number","precision","parseFloat","toFixed","OHIFCornerstoneViewportOverlay","this","props","imageId","scale","windowWidth","windowCenter","inconsistencyWarnings","value","zoomPercentage","seriesMetadata","cornerstone","metaData","get","imagePlaneModule","rows","columns","sliceThickness","sliceLocation","seriesNumber","seriesDescription","generalStudyModule","studyDate","studyTime","studyDescription","patientModule","patientId","patientName","instanceNumber","frameRate","frameTime","compression","generalImageModule","lossyImageCompression","lossyImageCompressionRatio","lossyImageCompressionMethod","getCompression","wwwc","imageDimensions","imageIndex","stackSize","inconsistencyWarningsOn","length","getWarningContent","warningList","Array","isArray","listedWarnings","map","warn","index","key","Fragment","normal","className","name","replace","trim","formatPN","date","strFormat","moment","format","formatDICOMDate","time","formatDICOMTime","placement","overlay","id","classNames","Icon","getWarningInfo","isNaN","PureComponent","PropTypes","isRequired","oneOfType","string","array","TOOL_NAMES","DICOM_SR_DISPLAY_TOOL","POINT","MULTIPOINT","POLYLINE","CIRCLE","ELLIPSE","POLYGON","draw","importInternal","drawJoinedLines","drawCircle","drawEllipse","drawHandles","drawArrow","getNewContext","BaseTool","drawLinkedTextBox","DICOMSRDisplayTool","defaultProps","mixins","initialProps","Object","assign","_module","csTools","getModule","evt","eventData","detail","element","module","toolState","getToolState","trackingUniqueIdentifiersForElement","getters","activeIndex","trackingUniqueIdentifiers","activeTrackingUniqueIdentifier","filteredToolData","data","filter","td","includes","TrackingUniqueIdentifier","i","renderableData","labels","color","toolColors","getActiveColor","getToolColor","options","lineWidth","handleRadius","keys","forEach","GraphicType","renderableDataForGraphicType","SCOORD_TYPES","renderPoint","renderMultipoint","renderPolyLine","renderCircle","renderEllipse","context","canvasContext","canvas","handles","textBox","active","hasMoved","movesIndependently","drawnIndependently","allowedOutsideImage","hasBoundingBox","anchorPoints","points","image","xOffset","yOffset","point","push","x","y","circle","center","radius","ellipse","corner1","corner2","halfWidth","Math","abs","halfHeight","_getTextBoxAnchorPointsForRenderableData","bottomRight","max","text","labelLength","min","lines","labelEntry","_labelToShorthand","label","_getTextBoxLinesFromLabels","textBoxAnchorPoints","handleStartCanvas","pixelToCanvas","handleEndCanvas","SHORT_HAND_MAP","AREA","Length","CORNERSTONEFREETEXT","shortHand","undefined","initSRTools","targetElement","toolAlias","toolName","getToolAlias","cornerstoneTools","addToolForElement","setToolEnabledForElement","LengthTool","configuration","renderDashed","ArrowAnnotateTool","BidirectionalTool","EllipticalRoiTool","RectangleRoiTool","FreehandRoiTool","setToolActiveForElement","pointers","mouseButtonMask","OHIF","redux","actions","setViewportActive","setViewportSpecificData","measurements","MeasurementHandlers","onAdded","onRemoved","onModified","MEASUREMENT_ACTION_MAP","added","removed","modified","throttle","event","ConnectedCornerstoneViewport","connect","state","ownProps","dataFromStore","extensions","viewportIndex","isActive","viewports","activeViewportIndex","viewportSpecificData","isPlaying","cine","cineFrameRate","isStackPrefetchEnabled","hasOwnProperty","stackPrefetch","enabled","dispatch","onElementEnabled","enabledElement","setEnabledElement","plugin","onMeasurementsChanged","action","CornerstoneViewport","studyMetadataManager","utils","checkForSRAnnotations","displaySet","srModule","getEnabledElement","StudyInstanceUID","studyMetadata","srDisplaySets","getDisplaySets","ds","Modality","_measurements","m","loaded","measurement","setters","activeTrackingUniqueIdentifierForElement","cs","updateImage","StackManager","OHIFCornerstoneViewport","viewportData","studies","displaySetInstanceUID","SOPInstanceUID","frameIndex","stack","getCornerstoneStack","console","log","clearStacks","Error","study","find","displaySets","set","storedStack","findOrCreateStack","currentImageIdIndex","imageIds","findIndex","sopClassUIDs","getViewportData","then","setState","setStateFromProps","prevProps","prevDisplaySet","childrenWithProps","children","child","React","cloneElement","imageIdIndex","onNewImageDebounced","sopInstanceUid","onNewImage","onNewImageDebounceTime","viewportOverlayComponent","customProps","Component","object","node","bool"],"mappings":"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","file":"8.bundle.3054c8efd6a282273f51.js","sourcesContent":["import moment from 'moment';\n\n/**\n * Checks if value is valid.\n *\n * @param {number} value\n * @returns {boolean} is valid.\n */\nfunction isValidNumber(value) {\n  return typeof value === 'number' && !isNaN(value);\n}\n\n/**\n * Formats number precision.\n *\n * @param {number} number\n * @param {number} precision\n * @returns {number} formatted number.\n */\nfunction formatNumberPrecision(number, precision) {\n  if (number !== null) {\n    return parseFloat(number).toFixed(precision);\n  }\n}\n\n/**\n * Formats DICOM date.\n *\n * @param {string} date\n * @param {string} strFormat\n * @returns {string} formatted date.\n */\nfunction formatDICOMDate(date, strFormat = 'MMM D, YYYY') {\n  return moment(date, 'YYYYMMDD').format(strFormat);\n}\n\n/**\n *    DICOM Time is stored as HHmmss.SSS, where:\n *      HH 24 hour time:\n *        m mm        0..59   Minutes\n *        s ss        0..59   Seconds\n *        S SS SSS    0..999  Fractional seconds\n *\n *        Goal: '24:12:12'\n *\n * @param {*} time\n * @param {string} strFormat\n * @returns {string} formatted name.\n */\nfunction formatDICOMTime(time, strFormat = 'HH:mm:ss') {\n  return moment(time, 'HH:mm:ss').format(strFormat);\n}\n\n/**\n * Formats a patient name for display purposes\n *\n * @param {string} name\n * @returns {string} formatted name.\n */\nfunction formatPN(name) {\n  if (!name) {\n    return;\n  }\n\n  // Convert the first ^ to a ', '. String.replace() only affects\n  // the first appearance of the character.\n  const commaBetweenFirstAndLast = name.replace('^', ', ');\n\n  // Replace any remaining '^' characters with spaces\n  const cleaned = commaBetweenFirstAndLast.replace(/\\^/g, ' ');\n\n  // Trim any extraneous whitespace\n  return cleaned.trim();\n}\n\n/**\n * Gets compression type\n *\n * @param {number} imageId\n * @returns {string} comrpession type.\n */\nfunction getCompression(imageId) {\n  const generalImageModule =\n    cornerstone.metaData.get('generalImageModule', imageId) || {};\n  const {\n    lossyImageCompression,\n    lossyImageCompressionRatio,\n    lossyImageCompressionMethod,\n  } = generalImageModule;\n\n  if (lossyImageCompression === '01' && lossyImageCompressionRatio !== '') {\n    const compressionMethod = lossyImageCompressionMethod || 'Lossy: ';\n    const compressionRatio = formatNumberPrecision(\n      lossyImageCompressionRatio,\n      2\n    );\n    return compressionMethod + compressionRatio + ' : 1';\n  }\n\n  return 'Lossless / Uncompressed';\n}\n\nexport { isValidNumber,\n  formatNumberPrecision,\n  formatDICOMDate,\n  formatDICOMTime,\n  formatPN,\n  getCompression\n};\n","import { PureComponent } from 'react';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport cornerstone from 'cornerstone-core';\nimport './OHIFCornerstoneViewportOverlay.css';\nimport {\n  isValidNumber,\n  formatNumberPrecision,\n  formatDICOMDate,\n  formatDICOMTime,\n  formatPN,\n  getCompression,\n} from '../utils/formatStudy';\nimport classNames from 'classnames';\nimport { Icon } from '@ohif/ui/src/elements/Icon';\nimport { Tooltip } from '@ohif/ui/src/components/tooltip';\nimport { OverlayTrigger } from '@ohif/ui/src/components/overlayTrigger';\n\nclass OHIFCornerstoneViewportOverlay extends PureComponent {\n  static propTypes = {\n    scale: PropTypes.number.isRequired,\n    windowWidth: PropTypes.oneOfType([\n      PropTypes.number.isRequired,\n      PropTypes.string.isRequired,\n    ]),\n    windowCenter: PropTypes.oneOfType([\n      PropTypes.number.isRequired,\n      PropTypes.string.isRequired,\n    ]),\n    imageId: PropTypes.string.isRequired,\n    imageIndex: PropTypes.number.isRequired,\n    stackSize: PropTypes.number.isRequired,\n    inconsistencyWarnings: PropTypes.array.isRequired,\n  };\n\n  render() {\n    const {\n      imageId,\n      scale,\n      windowWidth,\n      windowCenter,\n      inconsistencyWarnings,\n    } = this.props;\n\n    if (!imageId) {\n      return null;\n    }\n\n    const zoomPercentage = formatNumberPrecision(scale * 100, 0);\n    const seriesMetadata =\n      cornerstone.metaData.get('generalSeriesModule', imageId) || {};\n    const imagePlaneModule =\n      cornerstone.metaData.get('imagePlaneModule', imageId) || {};\n    const { rows, columns, sliceThickness, sliceLocation } = imagePlaneModule;\n    const { seriesNumber, seriesDescription } = seriesMetadata;\n\n    const generalStudyModule =\n      cornerstone.metaData.get('generalStudyModule', imageId) || {};\n    const { studyDate, studyTime, studyDescription } = generalStudyModule;\n\n    const patientModule =\n      cornerstone.metaData.get('patientModule', imageId) || {};\n    const { patientId, patientName } = patientModule;\n\n    const generalImageModule =\n      cornerstone.metaData.get('generalImageModule', imageId) || {};\n    const { instanceNumber } = generalImageModule;\n\n    const cineModule = cornerstone.metaData.get('cineModule', imageId) || {};\n    const { frameTime } = cineModule;\n\n    const frameRate = formatNumberPrecision(1000 / frameTime, 1);\n    const compression = getCompression(imageId);\n    const wwwc = `W: ${\n      windowWidth.toFixed ? windowWidth.toFixed(0) : windowWidth\n    } L: ${windowWidth.toFixed ? windowCenter.toFixed(0) : windowCenter}`;\n    const imageDimensions = `${columns} x ${rows}`;\n\n    const { imageIndex, stackSize } = this.props;\n\n    const inconsistencyWarningsOn =\n      inconsistencyWarnings && inconsistencyWarnings.length !== 0\n        ? true\n        : false;\n    const getWarningContent = warningList => {\n      if (Array.isArray(warningList)) {\n        const listedWarnings = warningList.map((warn, index) => {\n          return <li key={index}>{warn}</li>;\n        });\n\n        return <ol>{listedWarnings}</ol>;\n      } else {\n        return <React.Fragment>{warningList}</React.Fragment>;\n      }\n    };\n\n    const getWarningInfo = (seriesNumber, inconsistencyWarnings) => {\n      return (\n        <React.Fragment>\n          {inconsistencyWarnings.length != 0 ? (\n            <OverlayTrigger\n              key={seriesNumber}\n              placement=\"left\"\n              overlay={\n                <Tooltip\n                  placement=\"left\"\n                  className=\"in tooltip-warning\"\n                  id=\"tooltip-left\"\n                >\n                  <div className=\"warningTitle\">Series Inconsistencies</div>\n                  <div className=\"warningContent\">\n                    {getWarningContent(inconsistencyWarnings)}\n                  </div>\n                </Tooltip>\n              }\n            >\n              <div className={classNames('warning')}>\n                <span className=\"warning-icon\">\n                  <Icon name=\"exclamation-triangle\" />\n                </span>\n              </div>\n            </OverlayTrigger>\n          ) : (\n            <React.Fragment></React.Fragment>\n          )}\n        </React.Fragment>\n      );\n    };\n\n    const normal = (\n      <React.Fragment>\n        <div className=\"top-left overlay-element\">\n          <div>{formatPN(patientName)}</div>\n          <div>{patientId}</div>\n        </div>\n        <div className=\"top-right overlay-element\">\n          <div>{studyDescription}</div>\n          <div>\n            {formatDICOMDate(studyDate)} {formatDICOMTime(studyTime)}\n          </div>\n        </div>\n        <div className=\"bottom-right overlay-element\">\n          <div>Zoom: {zoomPercentage}%</div>\n          <div>{wwwc}</div>\n          <div className=\"compressionIndicator\">{compression}</div>\n        </div>\n        <div className=\"bottom-left2 warning\">\n          <div>\n            {inconsistencyWarningsOn\n              ? getWarningInfo(seriesNumber, inconsistencyWarnings)\n              : ''}\n          </div>\n        </div>\n        <div className=\"bottom-left overlay-element\">\n          <div>{seriesNumber >= 0 ? `Ser: ${seriesNumber}` : ''}</div>\n          <div>\n            {stackSize > 1\n              ? `Img: ${instanceNumber} ${imageIndex}/${stackSize}`\n              : ''}\n          </div>\n          <div>\n            {frameRate >= 0 ? `${formatNumberPrecision(frameRate, 2)} FPS` : ''}\n            <div>{imageDimensions}</div>\n            <div>\n              {isValidNumber(sliceLocation)\n                ? `Loc: ${formatNumberPrecision(sliceLocation, 2)} mm `\n                : ''}\n              {sliceThickness\n                ? `Thick: ${formatNumberPrecision(sliceThickness, 2)} mm`\n                : ''}\n            </div>\n            <div>{seriesDescription}</div>\n          </div>\n        </div>\n      </React.Fragment>\n    );\n\n    return <div className=\"OHIFCornerstoneViewportOverlay\">{normal}</div>;\n  }\n}\n\nexport default OHIFCornerstoneViewportOverlay;\n","const TOOL_NAMES = {\n  DICOM_SR_DISPLAY_TOOL: 'DICOMSRDisplayTool',\n};\n\nexport default TOOL_NAMES;\n","export default {\n  POINT: 'POINT',\n  MULTIPOINT: 'MULTIPOINT',\n  POLYLINE: 'POLYLINE',\n  CIRCLE: 'CIRCLE',\n  ELLIPSE: 'ELLIPSE',\n  POLYGON: 'POLYGON',\n};\n","import csTools, {\n  importInternal,\n  getToolState,\n  toolColors,\n} from 'cornerstone-tools';\n\nimport cornerstone from 'cornerstone-core';\n\n/** Internal imports */\nimport TOOL_NAMES from './constants/toolNames';\nimport SCOORD_TYPES from './constants/scoordTypes';\nimport id from './id';\n\n/** Cornerstone 3rd party dev kit imports */\nconst draw = importInternal('drawing/draw');\nconst drawJoinedLines = importInternal('drawing/drawJoinedLines');\nconst drawCircle = importInternal('drawing/drawCircle');\nconst drawEllipse = importInternal('drawing/drawEllipse');\nconst drawHandles = importInternal('drawing/drawHandles');\nconst drawArrow = importInternal('drawing/drawArrow');\nconst getNewContext = importInternal('drawing/getNewContext');\nconst BaseTool = importInternal('base/BaseTool');\nconst drawLinkedTextBox = importInternal('drawing/drawLinkedTextBox');\n\n/**\n * @class DICOMSRDisplayTool - Renders DICOMSR data in a read only manner (i.e. as an overlay).\n *\n * This is a generic render tool.\n *\n * A single tool that, given some schema, can render\n * POINT, MULTIPOINT, POLYLINE, CIRCLE, and ELLIPSE\n * value types for a given imageId.\n *\n *\n * @extends cornerstoneTools.BaseTool\n */\nexport default class DICOMSRDisplayTool extends BaseTool {\n  constructor(props = {}) {\n    const defaultProps = {\n      mixins: ['enabledOrDisabledBinaryTool'],\n      name: TOOL_NAMES.DICOM_SR_DISPLAY_TOOL,\n    };\n\n    const initialProps = Object.assign(defaultProps, props);\n\n    super(initialProps);\n\n    this._module = csTools.getModule(id);\n  }\n\n  renderToolData(evt) {\n    const eventData = evt.detail;\n    const { element } = eventData;\n    const module = this._module;\n\n    const toolState = getToolState(element, this.name);\n\n    if (!toolState) {\n      return;\n    }\n\n    const trackingUniqueIdentifiersForElement = module.getters.trackingUniqueIdentifiersForElement(\n      element\n    );\n\n    const {\n      activeIndex,\n      trackingUniqueIdentifiers,\n    } = trackingUniqueIdentifiersForElement;\n\n    const activeTrackingUniqueIdentifier =\n      trackingUniqueIdentifiers[activeIndex];\n\n    // Filter toolData to only render the data for the active SR.\n    const filteredToolData = toolState.data.filter(td =>\n      trackingUniqueIdentifiers.includes(td.TrackingUniqueIdentifier)\n    );\n\n    let shouldRepositionTextBoxes = false;\n\n    for (let i = 0; i < filteredToolData.length; i++) {\n      const data = filteredToolData[i];\n      const { renderableData, labels } = data;\n\n      const color =\n        data.TrackingUniqueIdentifier === activeTrackingUniqueIdentifier\n          ? toolColors.getActiveColor()\n          : toolColors.getToolColor();\n      const lineWidth = 2;\n      const options = {\n        color,\n        lineWidth,\n        handleRadius: 6,\n      };\n\n      Object.keys(renderableData).forEach(GraphicType => {\n        const renderableDataForGraphicType = renderableData[GraphicType];\n\n        switch (GraphicType) {\n          case SCOORD_TYPES.POINT:\n            this.renderPoint(renderableDataForGraphicType, eventData, options);\n            break;\n          case SCOORD_TYPES.MULTIPOINT:\n            this.renderMultipoint(\n              renderableDataForGraphicType,\n              eventData,\n              options\n            );\n            break;\n          case SCOORD_TYPES.POLYGON:\n          case SCOORD_TYPES.POLYLINE:\n            this.renderPolyLine(\n              renderableDataForGraphicType,\n              eventData,\n              options\n            );\n            break;\n          case SCOORD_TYPES.CIRCLE:\n            this.renderCircle(renderableDataForGraphicType, eventData, options);\n            break;\n          case SCOORD_TYPES.ELLIPSE:\n            this.renderEllipse(\n              renderableDataForGraphicType,\n              eventData,\n              options\n            );\n            break;\n        }\n      });\n\n      const { element } = eventData;\n      const context = getNewContext(eventData.canvasContext.canvas);\n\n      if (!data.handles || !data.handles.textBox) {\n        const textBox = {\n          active: false,\n          hasMoved: true,\n          movesIndependently: false,\n          drawnIndependently: true,\n          allowedOutsideImage: true,\n          hasBoundingBox: true,\n        };\n\n        const anchorPoints = _getTextBoxAnchorPointsForRenderableData(\n          renderableData,\n          eventData\n        );\n        textBox.anchorPoints = anchorPoints;\n\n        const bottomRight = {\n          x: Math.max(...anchorPoints.map(point => point.x)),\n          y: Math.max(...anchorPoints.map(point => point.y)),\n        };\n\n        textBox.x = bottomRight.x;\n        textBox.y = bottomRight.y;\n\n        data.handles = {};\n        data.handles.textBox = textBox;\n\n        shouldRepositionTextBoxes = true;\n      }\n\n      const text = _getTextBoxLinesFromLabels(labels);\n\n      function textBoxAnchorPoints() {\n        return data.handles.textBox.anchorPoints;\n      }\n\n      draw(context, context => {\n        drawLinkedTextBox(\n          context,\n          element,\n          data.handles.textBox,\n          text,\n          data.handles,\n          textBoxAnchorPoints,\n          color,\n          lineWidth,\n          0,\n          true\n        );\n      });\n    }\n\n    // TOOD -> text boxes may overlap with other annotations at the moment.\n    // To be fixed after we get requirements.\n    // if (shouldRepositionTextBoxes) {\n    //   this.repositionTextBox(filteredToolData, eventData);\n    // }\n  }\n\n  // repositionTextBox(toolData, eventData) {\n  //   const toolBoundingBoxes = [];\n\n  //   for (let i = 0; i < toolData.length; i++) {\n  //     const toolDataI = toolData[i];\n\n  //     const { textBox } = toolDataI.handles;\n  //     const { anchorPoints } = textBox;\n\n  //     const boundingBox = _getBoundingBoxFromAnchorPoints(anchorPoints);\n  //     // Get the textbox bounding locations.\n  //     // Get the tool extents.\n  //   }\n  // }\n\n  renderPolyLine(renderableData, eventData, options) {\n    const { element } = eventData;\n    const context = getNewContext(eventData.canvasContext.canvas);\n    renderableData.forEach(points => {\n      draw(context, context => {\n        drawJoinedLines(context, element, points[0], points, options);\n      });\n    });\n  }\n\n  renderMultipoint(renderableData, eventData, options) {\n    const context = getNewContext(eventData.canvasContext.canvas);\n\n    renderableData.forEach(points => {\n      draw(context, context => {\n        drawHandles(context, eventData, points, options);\n      });\n    });\n  }\n\n  renderPoint(renderableData, eventData, options) {\n    // Render single point as an arrow.\n    const { element, image } = eventData;\n    const { rows, columns } = image;\n    const context = getNewContext(eventData.canvasContext.canvas);\n\n    const { color, lineWidth } = options;\n\n    // Find a suitable length for the image size.\n\n    const xOffset = columns / 10;\n    const yOffset = rows / 10;\n\n    renderableData.forEach(points => {\n      const point = points[0]; // The SCOORD type is POINT so the array length is 1.\n      draw(context, context => {\n        // Draw the arrow\n        const handleStartCanvas = cornerstone.pixelToCanvas(element, point);\n        const handleEndCanvas = cornerstone.pixelToCanvas(element, {\n          x: point.x + xOffset,\n          y: point.y + yOffset,\n        });\n\n        drawArrow(\n          context,\n          handleEndCanvas,\n          handleStartCanvas,\n          color,\n          lineWidth,\n          false\n        );\n      });\n    });\n  }\n\n  renderCircle(renderableData, eventData, options) {\n    const { element } = eventData;\n\n    const context = getNewContext(eventData.canvasContext.canvas);\n\n    renderableData.forEach(circle => {\n      const { center, radius } = circle;\n\n      drawCircle(context, element, center, radius, options);\n    });\n  }\n\n  renderEllipse(renderableData, eventData, options) {\n    const { element } = eventData;\n\n    const context = getNewContext(eventData.canvasContext.canvas);\n\n    renderableData.forEach(ellipse => {\n      const { corner1, corner2 } = ellipse;\n\n      drawEllipse(\n        context,\n        element,\n        corner1,\n        corner2,\n        options,\n        'pixel',\n        0 // TODO -> Work our the initial rotation and add it here so we render appropriately rotated ellipses.\n      );\n    });\n  }\n}\n\nfunction _getTextBoxLinesFromLabels(labels) {\n  // TODO -> max 3 for now (label + shortAxis + longAxis), need a generic solution for this!\n\n  const labelLength = Math.min(labels.length, 3);\n  const lines = [];\n\n  for (let i = 0; i < labelLength; i++) {\n    const labelEntry = labels[i];\n    lines.push(`${_labelToShorthand(labelEntry.label)}${labelEntry.value}`);\n  }\n\n  return lines;\n}\n\nconst SHORT_HAND_MAP = {\n  'Short Axis': 'W ',\n  'Long Axis': 'L ',\n  AREA: 'Area ',\n  Length: '',\n  CORNERSTONEFREETEXT: '',\n};\n\nfunction _labelToShorthand(label) {\n  const shortHand = SHORT_HAND_MAP[label];\n\n  if (shortHand !== undefined) {\n    return shortHand;\n  }\n\n  return label;\n}\n\nfunction _getTextBoxAnchorPointsForRenderableData(renderableData, eventData) {\n  let anchorPoints = [];\n\n  Object.keys(renderableData).forEach(GraphicType => {\n    const renderableDataForGraphicType = renderableData[GraphicType];\n\n    switch (GraphicType) {\n      case SCOORD_TYPES.POINT:\n        renderableDataForGraphicType.forEach(points => {\n          anchorPoints = [...anchorPoints, ...points];\n\n          // Add other arrow point based on image size.\n          const { image } = eventData;\n          const { rows, columns } = image;\n\n          const xOffset = columns / 10;\n          const yOffset = rows / 10;\n          const point = points[0];\n\n          anchorPoints.push({ x: point.x + xOffset, y: point.y + yOffset });\n        });\n\n        break;\n      case SCOORD_TYPES.MULTIPOINT:\n      case SCOORD_TYPES.POLYLINE:\n      case SCOORD_TYPES.POLYGON:\n        renderableDataForGraphicType.forEach(points => {\n          anchorPoints = [...anchorPoints, ...points];\n        });\n        break;\n      case SCOORD_TYPES.CIRCLE:\n        renderableDataForGraphicType.forEach(circle => {\n          const { center, radius } = circle;\n\n          anchorPoints.push({ x: center.x + radius, y: center.y });\n          anchorPoints.push({ x: center.x - radius, y: center.y });\n          anchorPoints.push({ x: center.x, y: center.y + radius });\n          anchorPoints.push({ x: center.x, y: center.y - radius });\n        });\n\n        break;\n      case SCOORD_TYPES.ELLIPSE:\n        renderableDataForGraphicType.forEach(ellipse => {\n          const { corner1, corner2 } = ellipse;\n\n          const halfWidth = Math.abs(corner1.x - corner2.x) / 2;\n          const halfHeight = Math.abs(corner1.y - corner2.y) / 2;\n\n          const center = {\n            x: (corner1.x + corner2.x) / 2,\n            y: (corner1.y + corner2.y) / 2,\n          };\n\n          anchorPoints.push({ x: center.x + halfWidth, y: center.y });\n          anchorPoints.push({ x: center.x - halfWidth, y: center.y });\n          anchorPoints.push({ x: center.x, y: center.y + halfHeight });\n          anchorPoints.push({ x: center.x, y: center.y - halfHeight });\n        });\n        break;\n    }\n  });\n\n  return anchorPoints;\n}\n\nfunction _getBoundingBoxFromAnchorPoints(anchorPoints) {\n  let minX = Infinity;\n  let maxX = -Infinity;\n  let minY = Infinity;\n  let maxY = -Infinity;\n\n  anchorPoints.forEach(point => {\n    const { x, y } = point;\n\n    if (x > maxX) {\n      maxX = x;\n    } else if (x < minX) {\n      minX = x;\n    }\n\n    if (y > maxX) {\n      maxY = y;\n    } else if (y < minY) {\n      minY = y;\n    }\n  });\n}\n","import cornerstoneTools from 'cornerstone-tools';\nimport DICOMSRDisplayTool from './DICOMSRDisplayTool';\nimport TOOL_NAMES from './constants/toolNames';\nimport getToolAlias from './utils/getToolAlias';\n\n/**\n * Initialize SR cornerstone tools.\n *\n * @param {*} targetElement\n */\nconst initSRTools = targetElement => {\n  const primaryToolId = 'Wwwc';\n  const toolAlias = getToolAlias(primaryToolId); // These are 1:1 for built-in only\n\n  // ~~ MAGIC\n  cornerstoneTools.addToolForElement(targetElement, DICOMSRDisplayTool);\n  cornerstoneTools.setToolEnabledForElement(\n    targetElement,\n    TOOL_NAMES.DICOM_SR_DISPLAY_TOOL\n  );\n\n  // ~~ Variants\n  cornerstoneTools.addToolForElement(\n    targetElement,\n    cornerstoneTools.LengthTool,\n    {\n      name: 'SRLength',\n      configuration: {\n        renderDashed: true,\n      },\n    }\n  );\n  cornerstoneTools.addToolForElement(\n    targetElement,\n    cornerstoneTools.ArrowAnnotateTool,\n    {\n      name: 'SRArrowAnnotate',\n      configuration: {\n        renderDashed: true,\n      },\n    }\n  );\n  cornerstoneTools.addToolForElement(\n    targetElement,\n    cornerstoneTools.BidirectionalTool,\n    {\n      name: 'SRBidirectional',\n      configuration: {\n        renderDashed: true,\n      },\n    }\n  );\n  cornerstoneTools.addToolForElement(\n    targetElement,\n    cornerstoneTools.EllipticalRoiTool,\n    {\n      name: 'SREllipticalRoi',\n      configuration: {\n        renderDashed: true,\n      },\n    }\n  );\n  cornerstoneTools.addToolForElement(\n    targetElement,\n    cornerstoneTools.RectangleRoiTool,\n    {\n      name: 'SRRectangleRoi',\n      configuration: {\n        renderDashed: true,\n      },\n    }\n  );\n  cornerstoneTools.addToolForElement(\n    targetElement,\n    cornerstoneTools.FreehandRoiTool,\n    {\n      name: 'SRFreehandRoi',\n      configuration: {\n        renderDashed: true,\n      },\n    }\n  );\n\n  // ~~ Business as usual\n  cornerstoneTools.setToolActiveForElement(targetElement, 'PanMultiTouch', {\n    pointers: 2,\n  });\n  cornerstoneTools.setToolActiveForElement(targetElement, 'ZoomTouchPinch', {});\n\n  // TODO: Add always dashed tool alternative aliases\n  // TODO: or same name... alternative config?\n  cornerstoneTools.setToolActiveForElement(targetElement, toolAlias, {\n    mouseButtonMask: 1,\n  });\n  cornerstoneTools.setToolActiveForElement(targetElement, 'Pan', {\n    mouseButtonMask: 4,\n  });\n  cornerstoneTools.setToolActiveForElement(targetElement, 'Zoom', {\n    mouseButtonMask: 2,\n  });\n  cornerstoneTools.setToolActiveForElement(\n    targetElement,\n    'StackScrollMouseWheel',\n    {}\n  );\n};\n\nexport default initSRTools;\n","/**\n * Get cornerstone tool alias.\n *\n * @param {string} toolName\n * @returns tool alias\n */\nexport default function getToolAlias(toolName) {\n  let toolAlias = toolName;\n\n  switch (toolName) {\n    case 'Length':\n      toolAlias = 'SRLength';\n      break;\n    case 'Bidirectional':\n      toolAlias = 'SRBidirectional';\n      break;\n    case 'ArrowAnnotate':\n      toolAlias = 'SRArrowAnnotate';\n      break;\n    case 'EllipticalRoi':\n      toolAlias = 'SREllipticalRoi';\n      break;\n    case 'FreehandRoi':\n      toolAlias = 'SRFreehandRoi';\n      break;\n    case 'RectangleRoi':\n      toolAlias = 'SRRectangleRoi';\n      break;\n  }\n\n  return toolAlias;\n}\n","import CornerstoneViewport from 'react-cornerstone-viewport';\nimport OHIF from '@ohif/core';\nimport { connect } from 'react-redux';\nimport throttle from 'lodash.throttle';\nimport { setEnabledElement } from './state';\nimport initSRTools from './tools/initSRTools';\n\nconst { setViewportActive, setViewportSpecificData } = OHIF.redux.actions;\nconst {\n  onAdded,\n  onRemoved,\n  onModified,\n} = OHIF.measurements.MeasurementHandlers;\n\n// TODO: Transition to enums for the action names so that we can ensure they stay up to date\n// everywhere they're used.\nconst MEASUREMENT_ACTION_MAP = {\n  added: onAdded,\n  removed: onRemoved,\n  modified: throttle(event => {\n    return onModified(event);\n  }, 300),\n};\n\nconst mapStateToProps = (state, ownProps) => {\n  let dataFromStore;\n\n  // TODO: This may not be updated anymore :thinking:\n  if (state.extensions && state.extensions.cornerstone) {\n    dataFromStore = state.extensions.cornerstone;\n  }\n\n  // If this is the active viewport, enable prefetching.\n  const { viewportIndex } = ownProps; //.viewportData;\n  const isActive = viewportIndex === state.viewports.activeViewportIndex;\n  const viewportSpecificData =\n    state.viewports.viewportSpecificData[viewportIndex] || {};\n\n  // CINE\n  let isPlaying = false;\n  let frameRate = 24;\n\n  if (viewportSpecificData && viewportSpecificData.cine) {\n    const cine = viewportSpecificData.cine;\n\n    isPlaying = cine.isPlaying === true;\n    frameRate = cine.cineFrameRate || frameRate;\n  }\n\n  return {\n    // layout: state.viewports.layout,\n    isActive,\n    // TODO: Need a cleaner and more versatile way.\n    // Currently justing using escape hatch + commands\n    // activeTool: activeButton && activeButton.command,\n    ...dataFromStore,\n    isStackPrefetchEnabled: ownProps.hasOwnProperty('isStackPrefetchEnabled')\n      ? ownProps.isStackPrefetchEnabled\n      : ownProps.stackPrefetch\n      ? ownProps.stackPrefetch.enabled\n      : isActive,\n    isPlaying,\n    frameRate,\n    //stack: viewportSpecificData.stack,\n    // viewport: viewportSpecificData.viewport,\n  };\n};\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n  const { viewportIndex } = ownProps;\n\n  return {\n    setViewportActive: () => {\n      dispatch(setViewportActive(viewportIndex));\n    },\n\n    setViewportSpecificData: data => {\n      dispatch(setViewportSpecificData(viewportIndex, data));\n    },\n\n    /**\n     * Our component \"enables\" the underlying dom element on \"componentDidMount\"\n     * It listens for that event, and then emits the enabledElement. We can grab\n     * a reference to it here, to make playing with cornerstone's native methods\n     * easier.\n     */\n    onElementEnabled: event => {\n      const enabledElement = event.detail.element;\n      setEnabledElement(viewportIndex, enabledElement);\n      dispatch(\n        setViewportSpecificData(viewportIndex, {\n          // TODO: Hack to make sure our plugin info is available from the outset\n          plugin: 'cornerstone',\n        })\n      );\n      initSRTools(enabledElement);\n    },\n\n    onMeasurementsChanged: (event, action) => {\n      return MEASUREMENT_ACTION_MAP[action](event);\n    },\n  };\n};\n\nconst ConnectedCornerstoneViewport = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(CornerstoneViewport);\n\nexport default ConnectedCornerstoneViewport;\n","import csTools from 'cornerstone-tools';\nimport cs from 'cornerstone-core';\nimport OHIF from '@ohif/core';\n\nimport { getEnabledElement } from '../state';\nimport id from './id';\n\nconst { studyMetadataManager } = OHIF.utils;\n\nconst checkForSRAnnotations = ({ viewportIndex, displaySet }) => {\n  const srModule = csTools.getModule(id);\n\n  const element = getEnabledElement(viewportIndex);\n  if (!element) {\n    return;\n  }\n\n  const { StudyInstanceUID } = displaySet;\n  const studyMetadata = studyMetadataManager.get(StudyInstanceUID);\n  if (!studyMetadata) {\n    return;\n  }\n\n  const srDisplaySets = studyMetadata\n    .getDisplaySets()\n    .filter(ds => ds.Modality === 'SR');\n  if (srDisplaySets.length === 0) {\n    return;\n  }\n\n  const { measurements: _measurements } = srDisplaySets[0];\n  if (!_measurements || _measurements.length < 1) {\n    return;\n  }\n\n  const measurements = _measurements.filter(m => m.loaded === true);\n  const measurement = measurements[0];\n  if (!measurement) {\n    return;\n  }\n\n  srModule.setters.trackingUniqueIdentifiersForElement(\n    element,\n    measurements.map(measurement => measurement.TrackingUniqueIdentifier),\n    measurement\n  );\n\n  const { TrackingUniqueIdentifier } = measurement;\n  srModule.setters.activeTrackingUniqueIdentifierForElement(\n    element,\n    TrackingUniqueIdentifier\n  );\n\n  cs.updateImage(element);\n};\n\nexport default checkForSRAnnotations;\n","import React, { Component } from 'react';\n\nimport OHIFCornerstoneViewportOverlay from './components/OHIFCornerstoneViewportOverlay';\nimport ConnectedCornerstoneViewport from './ConnectedCornerstoneViewport';\nimport OHIF from '@ohif/core';\nimport PropTypes from 'prop-types';\nimport cornerstone from 'cornerstone-core';\nimport checkForSRAnnotations from './tools/checkForSRAnnotations';\n\nconst { StackManager } = OHIF.utils;\n\nclass OHIFCornerstoneViewport extends Component {\n  state = {\n    viewportData: null,\n  };\n\n  static defaultProps = {\n    customProps: {},\n    isStackPrefetchEnabled: true,\n  };\n\n  static propTypes = {\n    studies: PropTypes.object,\n    displaySet: PropTypes.object,\n    viewportIndex: PropTypes.number,\n    children: PropTypes.node,\n    customProps: PropTypes.object,\n    stackPrefetch: PropTypes.object,\n    isStackPrefetchEnabled: PropTypes.bool,\n  };\n\n  static id = 'OHIFCornerstoneViewport';\n\n  static init() {\n    console.log('OHIFCornerstoneViewport init()');\n  }\n\n  static destroy() {\n    console.log('OHIFCornerstoneViewport destroy()');\n    StackManager.clearStacks();\n  }\n\n  /**\n   * Obtain the CornerstoneTools Stack for the specified display set.\n   *\n   * @param {Object[]} studies\n   * @param {String} StudyInstanceUID\n   * @param {String} displaySetInstanceUID\n   * @param {String} [SOPInstanceUID]\n   * @param {Number} [frameIndex=1]\n   * @return {Object} CornerstoneTools Stack\n   */\n  static getCornerstoneStack(\n    studies,\n    StudyInstanceUID,\n    displaySetInstanceUID,\n    SOPInstanceUID,\n    frameIndex = 0\n  ) {\n    if (!studies || !studies.length) {\n      throw new Error('Studies not provided.');\n    }\n\n    if (!StudyInstanceUID) {\n      throw new Error('StudyInstanceUID not provided.');\n    }\n\n    if (!displaySetInstanceUID) {\n      throw new Error('StudyInstanceUID not provided.');\n    }\n\n    // Create shortcut to displaySet\n    const study = studies.find(\n      study => study.StudyInstanceUID === StudyInstanceUID\n    );\n\n    if (!study) {\n      throw new Error('Study not found.');\n    }\n\n    const displaySet = study.displaySets.find(set => {\n      return set.displaySetInstanceUID === displaySetInstanceUID;\n    });\n\n    if (!displaySet) {\n      throw new Error('Display Set not found.');\n    }\n\n    // Get stack from Stack Manager\n    const storedStack = StackManager.findOrCreateStack(study, displaySet);\n\n    // Clone the stack here so we don't mutate it\n    const stack = Object.assign({}, storedStack);\n    stack.currentImageIdIndex = frameIndex;\n\n    if (SOPInstanceUID) {\n      const index = stack.imageIds.findIndex(imageId => {\n        const imageIdSOPInstanceUID = cornerstone.metaData.get(\n          'SOPInstanceUID',\n          imageId\n        );\n\n        return imageIdSOPInstanceUID === SOPInstanceUID;\n      });\n\n      if (index > -1) {\n        stack.currentImageIdIndex = index;\n      } else {\n        console.warn(\n          'SOPInstanceUID provided was not found in specified DisplaySet'\n        );\n      }\n    }\n\n    return stack;\n  }\n\n  getViewportData = async (\n    studies,\n    StudyInstanceUID,\n    displaySetInstanceUID,\n    SOPInstanceUID,\n    frameIndex\n  ) => {\n    let viewportData;\n\n    const stack = OHIFCornerstoneViewport.getCornerstoneStack(\n      studies,\n      StudyInstanceUID,\n      displaySetInstanceUID,\n      SOPInstanceUID,\n      frameIndex\n    );\n\n    viewportData = {\n      StudyInstanceUID,\n      displaySetInstanceUID,\n      stack,\n    };\n\n    return viewportData;\n  };\n\n  setStateFromProps() {\n    const { studies, displaySet } = this.props.viewportData;\n    const {\n      StudyInstanceUID,\n      displaySetInstanceUID,\n      sopClassUIDs,\n      SOPInstanceUID,\n      frameIndex,\n    } = displaySet;\n\n    if (!StudyInstanceUID || !displaySetInstanceUID) {\n      return;\n    }\n\n    if (sopClassUIDs && sopClassUIDs.length > 1) {\n      console.warn(\n        'More than one SOPClassUID in the same series is not yet supported.'\n      );\n    }\n\n    this.getViewportData(\n      studies,\n      StudyInstanceUID,\n      displaySetInstanceUID,\n      SOPInstanceUID,\n      frameIndex\n    ).then(viewportData => {\n      this.setState({\n        viewportData,\n      });\n    });\n  }\n\n  componentDidMount() {\n    this.setStateFromProps();\n  }\n\n  componentDidUpdate(prevProps) {\n    const { displaySet } = this.props.viewportData;\n    const prevDisplaySet = prevProps.viewportData.displaySet;\n\n    if (\n      displaySet.displaySetInstanceUID !==\n        prevDisplaySet.displaySetInstanceUID ||\n      displaySet.SOPInstanceUID !== prevDisplaySet.SOPInstanceUID ||\n      displaySet.frameIndex !== prevDisplaySet.frameIndex\n    ) {\n      const { viewportIndex } = this.props;\n      checkForSRAnnotations({ displaySet, viewportIndex });\n      this.setStateFromProps();\n    }\n  }\n\n  render() {\n    let childrenWithProps = null;\n\n    if (!this.state.viewportData) {\n      return null;\n    }\n    const { viewportIndex } = this.props;\n    const { inconsistencyWarnings } = this.props.viewportData.displaySet;\n    const {\n      imageIds,\n      currentImageIdIndex,\n      // If this comes from the instance, would be a better default\n      // `FrameTime` in the instance\n      // frameRate = 0,\n    } = this.state.viewportData.stack;\n\n    // TODO: Does it make more sense to use Context?\n    if (this.props.children && this.props.children.length) {\n      childrenWithProps = this.props.children.map((child, index) => {\n        return (\n          child &&\n          React.cloneElement(child, {\n            viewportIndex: this.props.viewportIndex,\n            key: index,\n          })\n        );\n      });\n    }\n\n    const newImageHandler = ({ currentImageIdIndex, sopInstanceUid }) => {\n      const { displaySet } = this.props.viewportData;\n      const { StudyInstanceUID } = displaySet;\n\n      if (currentImageIdIndex >= 0) {\n        this.props.onNewImage({\n          StudyInstanceUID,\n          SOPInstanceUID: sopInstanceUid,\n          frameIndex: currentImageIdIndex,\n          activeViewportIndex: viewportIndex,\n        });\n      }\n    };\n\n    const warningsOverlay = props => {\n      return (\n        <OHIFCornerstoneViewportOverlay\n          {...props}\n          inconsistencyWarnings={inconsistencyWarnings}\n        />\n      );\n    };\n\n    return (\n      <>\n        <ConnectedCornerstoneViewport\n          viewportIndex={viewportIndex}\n          imageIds={imageIds}\n          imageIdIndex={currentImageIdIndex}\n          onNewImageDebounced={newImageHandler}\n          onNewImageDebounceTime={300}\n          viewportOverlayComponent={warningsOverlay}\n          stackPrefetch={this.props.stackPrefetch}\n          isStackPrefetchEnabled={this.props.isStackPrefetchEnabled}\n          // ~~ Connected (From REDUX)\n          // frameRate={frameRate}\n          // isPlaying={false}\n          // onElementEnabled={() => {}}\n          // setViewportActive{() => {}}\n          {...this.props.customProps}\n        />\n        {childrenWithProps}\n      </>\n    );\n  }\n}\n\nexport default OHIFCornerstoneViewport;\n"],"sourceRoot":""}